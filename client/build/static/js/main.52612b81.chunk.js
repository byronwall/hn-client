(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{103:function(e,t,a){e.exports=a(188)},134:function(e,t,a){},188:function(e,t,a){"use strict";a.r(t);a(104),a(106),a(108);var n=a(55),r=a(35),o=a.n(r),i=a(0),s=a.n(i),c=a(40),l=a.n(c),u=a(50),d=a(54),p=a(88),h=a.n(p),f=a(92),m=a(11),v=a(13),b=a(12),g=a(9),y=a(14),k=a(21),E=(a(134),a(22)),O=a.n(E),j=a(94),w=a(63),L=a(95),S=a(19),x=a.n(S),D=a(26),I=function(e){function t(e){var a;return Object(m.a)(this,t),(a=Object(v.a)(this,Object(b.a)(t).call(this,e))).state={item:void 0},a}return Object(y.a)(t,e),Object(g.a)(t,[{key:"render",value:function(){return null}},{key:"componentDidMount",value:function(){var e=Object(D.a)(x.a.mark(function e(){var t,a,n=this;return x.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.a.getItem(this.props.storageName);case 2:if(void 0!==(t=e.sent)&&null!==t){e.next=6;break}return this.setState({item:void 0},function(){return n.props.dataDidUpdate(void 0)}),e.abrupt("return");case 6:if(null!==t){e.next=10;break}return o.a.removeItem(this.props.storageName),this.setState({item:void 0},function(){return n.props.dataDidUpdate(void 0)}),e.abrupt("return");case 10:a=JSON.parse(t),this.setState({item:a},function(){return n.props.dataDidUpdate(a)});case 12:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"componentDidUpdate",value:function(e,t){var a=this;if(!O.a.isEqual(e.activeItem,this.props.activeItem)){if(void 0===this.props.activeItem)return;if(O.a.isEqual(this.state.item,this.props.activeItem))return;console.log("save item",this.props.activeItem);var n=JSON.stringify(this.props.activeItem);o.a.setItem(this.props.storageName,n),this.setState({item:this.props.activeItem},function(){console.log("updating data after a save?"),a.props.dataDidUpdate(a.props.activeItem)})}}}]),t}(s.a.Component),C=function(e){function t(e){var a;return Object(m.a)(this,t),(a=Object(v.a)(this,Object(b.a)(t).call(this,e))).state={allItems:[],currentLists:[],isLoadingFresh:!1},a}return Object(y.a)(t,e),Object(g.a)(t,[{key:"refreshData",value:function(e){}}]),Object(g.a)(t,[{key:"render",value:function(){var e=this;return s.a.createElement(s.a.Fragment,null,s.a.createElement(I,{dataDidUpdate:function(t){return e.processDataFromLocalStorage(t,e.state.currentLists)},activeItem:this.state.allItems,storageName:"HN-ALL-ITEMS"}),s.a.createElement(I,{dataDidUpdate:function(t){return e.processDataFromLocalStorage(e.state.allItems,t)},activeItem:this.state.currentLists,storageName:"HN-DATA-LISTS"}))}},{key:"getStoryData",value:function(){var e=Object(D.a)(x.a.mark(function e(t){var a;return x.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===(a=this.state.allItems.find(function(e){return e.id===t}))){e.next=3;break}return e.abrupt("return",a);case 3:return e.next=5,this.getStoryFromServer(t);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getStoryFromServer",value:function(){var e=Object(D.a)(x.a.mark(function e(t){var a,n,r;return x.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a="/api/story/"+t,this.props.updateIsLoadingStatus(!0),e.next=4,fetch(a);case 4:if((n=e.sent).ok){e.next=8;break}return console.error(n),e.abrupt("return",void 0);case 8:return e.next=10,n.json();case 10:if(!("error"in(r=e.sent))){e.next=15;break}return console.error(r),this.props.updateIsLoadingStatus(!1),e.abrupt("return",void 0);case 15:return console.log("hn item from server",r),this.props.updateIsLoadingStatus(!1),e.abrupt("return",r);case 18:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getPageData",value:function(e){var t=this;console.log("getpagedata",e,this.state),""!==e&&void 0!==e||(e="front");var a={day:Y.Day,week:Y.Week,month:Y.Month,front:Y.Front}[e];if(void 0===a)return console.error("unknown page -> source map"),[];var n=this.state.currentLists.find(function(e){return e.key===a});return void 0===n?(console.log("no ids to load..."),this.loadData(a),[]):n.stories.map(function(e){return t.state.allItems.find(function(t){return t.id===e})}).filter(function(e){return void 0!==e})}},{key:"loadData",value:function(){var e=Object(D.a)(x.a.mark(function e(t){var a,n,r;return x.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:console.log("loading data"),a="",e.t0=t,e.next=e.t0===Y.Front?5:e.t0===Y.Day?7:e.t0===Y.Week?9:e.t0===Y.Month?11:13;break;case 5:return a="/topstories/topstories",e.abrupt("break",13);case 7:return a="/topstories/day",e.abrupt("break",13);case 9:return a="/topstories/week",e.abrupt("break",13);case 11:return a="/topstories/month",e.abrupt("break",13);case 13:return this.props.updateIsLoadingStatus(!0),e.next=16,fetch(a);case 16:if((n=e.sent).ok){e.next=21;break}return console.error(n),this.props.updateIsLoadingStatus(!1),e.abrupt("return");case 21:return e.next=23,n.json();case 23:r=e.sent,t!==Y.Front&&(r=O.a.sortBy(r,function(e){return-e.score})),console.log("hn items from server",r),this.props.updateIsLoadingStatus(!1),this.updateNewItems(r,t);case 28:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"processDataFromLocalStorage",value:function(e,t){var a=this;console.log("fresh data from local storage",e,t),void 0!==e&&this.setState({allItems:e}),void 0!==t&&this.setState({currentLists:t}),void 0!==e&&void 0!==t?t.forEach(function(t){var n=t.stories.map(function(t){return e.find(function(e){return e.id===t})}).filter(function(e){return void 0!==e});a.props.provideNewItems(n,t.key)}):this.state.isLoadingFresh||(this.loadData(Y.Front),this.setState({isLoadingFresh:!0}))}},{key:"updateNewItems",value:function(e,t){var a=this;console.log("items coming from server",e,t),void 0===e&&(e=[]);var n=e.map(function(e){return e.id}),r=O.a.cloneDeep(this.state.currentLists),o=r.find(function(e){return e.key===t});void 0===o?r.push({key:t,stories:n}):o.stories=n;var i=O.a.cloneDeep(this.state.allItems),s=[];e.forEach(function(e){var t=i.findIndex(function(t){return t.id===e.id});if(-1===t)return i.push(e),void s.push(e);var a=i[t];a.lastUpdated>e.lastUpdated?s.push(a):(i[t]=e,s.push(e))}),this.setState({allItems:i,currentLists:r},function(){a.props.provideNewItems(s,t)})}}]),t}(s.a.Component),N=a(194),F=a(196),M=a(191),R=a(192),W=a(193),T=a(52),U=a(62),A=a(195),H=function(e){function t(){return Object(m.a)(this,t),Object(v.a)(this,Object(b.a)(t).apply(this,arguments))}return Object(y.a)(t,e),Object(g.a)(t,[{key:"render",value:function(){var e=this;return s.a.createElement(N.a,null,s.a.createElement(N.a.Header,null,s.a.createElement(N.a.Brand,null,s.a.createElement(U.a,{to:"/"},"hn-offline"))),s.a.createElement(F.a,null,s.a.createElement(T.LinkContainer,{to:"/day"},s.a.createElement(M.a,{eventKey:1},"day")),s.a.createElement(T.LinkContainer,{to:"/week"},s.a.createElement(M.a,{eventKey:2},"week")),s.a.createElement(T.LinkContainer,{to:"/month"},s.a.createElement(M.a,{eventKey:3},"month"))),s.a.createElement(N.a.Form,{pullRight:!0},this.props.isLoading&&s.a.createElement(A.a,{size:32}),!this.props.isLoading&&s.a.createElement(d.a,{render:function(t){return-1===t.location.pathname.indexOf("/story")?s.a.createElement(R.a,{bsStyle:"primary",onClick:function(){return e.props.requestNewData()}},s.a.createElement(W.a,{glyph:"refresh"})):null}})))}}]),t}(s.a.PureComponent),P=a(49);function q(e){if(void 0===e)return"";var t=e.match(/^https?\:\/\/([^\/?#]+)(?:[\/?#]|$)/i);return t&&t[1]}function B(e){var t=Math.floor((new Date).getTime()/1e3-e),a=Math.floor(t/31536e3);return a>1?a+" years":(a=Math.floor(t/2592e3))>1?a+" months":(a=Math.floor(t/86400))>1?a+" days":(a=Math.floor(t/3600))>=1?a+" hour"+(a>1?"s":""):(a=Math.floor(t/60))>1?a+" minutes":Math.floor(t)+" seconds"}var J=function(e){function t(){return Object(m.a)(this,t),Object(v.a)(this,Object(b.a)(t).apply(this,arguments))}return Object(y.a)(t,e),Object(g.a)(t,[{key:"render",value:function(){var e=this.props.data,t=s.a.createElement(s.a.Fragment,null," | ",s.a.createElement(P.a,{to:"/story/"+e.id},s.a.createElement(W.a,{glyph:"comment"})," ",e.descendants)),a=void 0===e.url?s.a.createElement(P.a,{to:"/story/"+e.id},e.title):s.a.createElement("a",{href:e.url},e.title);return s.a.createElement("div",null,s.a.createElement("p",null,a),s.a.createElement("p",null,s.a.createElement("span",null,s.a.createElement(W.a,{glyph:"chevron-up"})," "," "+e.score),void 0!==e.descendants&&t,s.a.createElement("span",null," | "+B(e.time)+" ago"),s.a.createElement("span",null," | "+q(e.url))))}}]),t}(s.a.Component),_=function(e){function t(e){var a;return Object(m.a)(this,t),(a=Object(v.a)(this,Object(b.a)(t).call(this,e))).state={items:[]},a}return Object(y.a)(t,e),Object(g.a)(t,[{key:"render",value:function(){return document.title="HN: Offline",s.a.createElement("div",null,this.props.items.map(function(e){return s.a.createElement(J,{data:e,key:e.id})}))}}]),t}(s.a.Component),K=a(4),$=a.n(K),z=a(74),X=function(e){function t(e){var a;return Object(m.a)(this,t),(a=Object(v.a)(this,Object(b.a)(t).call(this,e))).childRefs=[],e.childComments.forEach(function(e){null!==e&&(a.childRefs[e.id]=s.a.createRef())}),a}return Object(y.a)(t,e),Object(g.a)(t,[{key:"render",value:function(){var e=this,t=this.props.childComments.filter(function(e){return null!==e});return s.a.createElement(s.a.Fragment,null,t.map(function(a,n){return s.a.createElement(Q,{key:a.id,comment:a,depth:e.props.depth,canExpand:e.props.canExpand,ref:e.childRefs[a.id],scrollToNextChild:function(){var a=t[n+1],r=t[n];if(null!==r){void 0!==a&&null!==a||(a=r);var o=e.childRefs[a.id].current.getDivRef(),i=Object(z.a)(o,{block:"nearest",inline:"nearest",scrollMode:"if-needed"}),s=e.childRefs[r.id].current.getDivRef(),c=Object(z.a)(s,{block:"nearest",inline:"nearest",scrollMode:"if-needed"});0==i.length&&0==c.length||window.scrollTo({top:o.offsetTop-80,behavior:"smooth"})}}})}))}}]),t}(s.a.Component),G=["#bc8672","#c5be53","#d46850","#8c7f3b","#dec392","#c9893a"],Q=function(e){function t(e){var a;return Object(m.a)(this,t),(a=Object(v.a)(this,Object(b.a)(t).call(this,e))).state={isOpen:!0,expandSelf:!1},a.divRef=s.a.createRef(),a}return Object(y.a)(t,e),Object(g.a)(t,null,[{key:"getDerivedStateFromProps",value:function(e,t){return e.canExpand?null:{isOpen:t.isOpen,expandSelf:!1}}}]),Object(g.a)(t,[{key:"getDivRef",value:function(){return this.divRef.current}},{key:"render",value:function(){var e=this,t=this.props.comment;if(null===t)return null;var a=(t.kidsObj||[]).filter(V),n=t.text||"";if(!V(t))return null;var r=this.state.isOpen?s.a.createElement(s.a.Fragment,null,s.a.createElement("p",{className:"comment",dangerouslySetInnerHTML:{__html:n}}),a.length>0&&s.a.createElement(X,{childComments:a,canExpand:this.props.canExpand&&!this.state.expandSelf,depth:this.props.depth+1})):null,o=this.props.depth<G.length?G[this.props.depth]:"#bbb";return s.a.createElement("div",{className:$()("bp3-card",{collapsed:!this.state.isOpen}),onClick:function(t){return e.handleCardClick(t)},style:{paddingLeft:12,marginLeft:this.state.expandSelf&&this.state.isOpen?-15*this.props.depth:0,borderLeftColor:o,borderLeftWidth:this.state.expandSelf?6:void 0,borderRight:this.state.expandSelf?"1px solid"+o:void 0,paddingRight:this.state.expandSelf?6:void 0}},s.a.createElement("p",{style:{fontWeight:this.state.isOpen?450:300},ref:this.divRef},t.by," | ",B(t.time)," ago"),r)}},{key:"handleCardClick",value:function(e){var t=this;if(e.stopPropagation(),"A"!==e.target.tagName){var a=e.target,n=this.state.expandSelf?.85:.9;if(this.props.depth>0&&this.props.canExpand&&(e.pageX+a.offsetLeft)/window.innerWidth>n)this.setState({expandSelf:!this.state.expandSelf});else{var r=!this.state.isOpen;this.setState({isOpen:r},function(){r||t.props.scrollToNextChild()})}}}}]),t}(s.a.Component);function V(e){return null!==e&&!(e.deleted&&(void 0===e.kidsObj||0===e.kidsObj.length))}var Y,Z=function(e){function t(e){var a;return Object(m.a)(this,t),(a=Object(v.a)(this,Object(b.a)(t).call(this,e))).state={data:void 0},a.anchorClickHandler=a.anchorClickHandler.bind(Object(k.a)(Object(k.a)(a))),a}return Object(y.a)(t,e),Object(g.a)(t,[{key:"render",value:function(){if(void 0===this.state.data)return null;var e=this.state.data,t=void 0===e.url?s.a.createElement("span",null,e.title):s.a.createElement("a",{href:e.url},e.title),a=(e.kidsObj||[]).filter(V);return document.title="HN: ".concat(e.title),s.a.createElement("div",null,s.a.createElement("h2",{style:{overflowWrap:"break-word"}},t),s.a.createElement("h4",null,s.a.createElement("span",null,e.by),s.a.createElement("span",null," | "),s.a.createElement("span",null,e.score," points"),s.a.createElement("span",null," | "),s.a.createElement("span",null,B(e.time)," ago"),s.a.createElement("span",null," | "),s.a.createElement("span",null,q(e.url))),void 0!==e.text&&s.a.createElement("p",{className:"top-text",dangerouslySetInnerHTML:{__html:e.text}}),s.a.createElement(X,{childComments:a,canExpand:!0,depth:0}))}},{key:"componentDidMount",value:function(){window.scrollTo(0,0),this.updateDataFromDataLayer(),document.body.addEventListener("click",this.anchorClickHandler)}},{key:"componentWillUnmount",value:function(){document.body.removeEventListener("click",this.anchorClickHandler)}},{key:"anchorClickHandler",value:function(e){if("A"===e.target.tagName){var t=e.target.href.match(/https?:\/\/news\.ycombinator\.com\/item\?id=(\d+)/);if(null!==t)return this.props.history.push("/story/"+t[1]),e.preventDefault(),!1}}},{key:"updateDataFromDataLayer",value:function(){var e=Object(D.a)(x.a.mark(function e(){var t;return x.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getStoryData(this.props.id);case 2:t=e.sent,this.setState({data:t});case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"componentDidUpdate",value:function(e){null===e.dataLayer&&null!==this.props.dataLayer&&this.updateDataFromDataLayer()}},{key:"getStoryData",value:function(){var e=Object(D.a)(x.a.mark(function e(t){return x.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==this.props.dataLayer){e.next=4;break}e.t0=void 0,e.next=7;break;case 4:return e.next=6,this.props.dataLayer.getStoryData(t);case 6:e.t0=e.sent;case 7:return e.abrupt("return",e.t0);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),t}(s.a.Component),ee=function(e){function t(e){var a;return Object(m.a)(this,t),(a=Object(v.a)(this,Object(b.a)(t).call(this,e))).state={items:[],allItems:[],activeList:Y.Front,error:void 0,isLoading:!1},a.dataLayer=s.a.createRef(),a.updateActiveDataStore=a.updateActiveDataStore.bind(Object(k.a)(Object(k.a)(a))),a.newItemsProvided=a.newItemsProvided.bind(Object(k.a)(Object(k.a)(a))),a}return Object(y.a)(t,e),Object(g.a)(t,null,[{key:"getDerivedStateFromProps",value:function(e,t){var a;switch(e.match.params.page){case"day":a=Y.Day;break;case"week":a=Y.Week;break;case"month":a=Y.Month;break;default:a=Y.Front}return console.log("derived state",e.match.params.page,a),Object(f.a)({},t,{activeList:a})}}]),Object(g.a)(t,[{key:"updateActiveDataStore",value:function(e,t){t&&this.setState({items:e}),this.setState(function(t){var a=O.a.cloneDeep(t.allItems).concat(e);return a=O.a.uniqBy(a,function(e){return e.id}),console.log("new all itemS",a),{allItems:a}})}},{key:"render",value:function(){var e=this;return console.log("render state",this.state,this.dataLayer),void 0!==this.state.error?s.a.createElement("div",null,s.a.createElement("p",null,"an error occurred, refresh the page"),s.a.createElement("p",null,"unfortunately, your local data was cleared to prevent corruption")):s.a.createElement("div",null,s.a.createElement(C,{ref:this.dataLayer,provideNewItems:this.newItemsProvided,updateIsLoadingStatus:function(t){return e.setState({isLoading:t})}}),s.a.createElement(H,{requestNewData:function(){e.dataLayer.current.loadData(e.state.activeList)},isLoading:this.state.isLoading}),s.a.createElement(j.a,null,s.a.createElement(w.a,{path:"/story/:id",exact:!0,render:function(t){return s.a.createElement(Z,{id:+t.match.params.id,dataLayer:e.dataLayer.current,history:t.history,key:+t.match.params.id})}}),s.a.createElement(w.a,{path:"/:page?",render:function(t){return s.a.createElement(_,{items:null===e.dataLayer.current?[]:e.dataLayer.current.getPageData(t.match.params.page)})}})))}},{key:"newItemsProvided",value:function(e,t){t===this.state.activeList&&this.setState({items:e})}}]),t}(s.a.Component),te=Object(L.a)(ee);!function(e){e[e.Front=0]="Front",e[e.Day=1]="Day",e[e.Week=2]="Week",e[e.Month=3]="Month"}(Y||(Y={}));var ae=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function ne(e,t){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var a=e.installing;null!=a&&(a.onstatechange=function(){"installed"===a.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See http://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}}).catch(function(e){console.error("Error during service worker registration:",e)})}h.a.polyfill(),n.init({dsn:"https://d8e8092157294c86b5014343cede60e6@sentry.io/1362584"}),window.onerror=function(e,t,a,r,i){console.error("major error",e),o.a.clear(),n.captureException(i),document.body.innerHTML="<h1>major error occurred.  local storage cleared to avoid corruption. please refresh</h1>"},l.a.render(s.a.createElement(u.a,null,s.a.createElement(d.a,{path:"/:page?"},s.a.createElement(te,null))),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",function(){var t="".concat("","/service-worker.js");ae?(function(e,t){fetch(e).then(function(a){var n=a.headers.get("content-type");404===a.status||null!=n&&-1===n.indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):ne(e,t)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(t,e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit http://bit.ly/CRA-PWA")})):ne(t,e)})}}()}},[[103,2,1]]]);
//# sourceMappingURL=main.52612b81.chunk.js.map