{"version":3,"sources":["getDomain.tsx","HnCommentList.tsx","timeSince.tsx","HnComment.tsx","HnStoryPage.tsx","App.tsx","DataLayer.tsx","Header.tsx","HnListItem.tsx","HnStoryList.tsx","serviceWorker.ts","index.tsx"],"names":["getDomain","url","undefined","matches","match","HnCommentList","props","childRefs","childComments","forEach","item","id","React","createRef","validChildren","this","filter","comm","Fragment","map","childComm","index","key","comment","depth","canExpand","ref","onUpdateOpen","newOpen","scrollId","isOpen","collapsedIds","findIndex","c","idToScrollTo","Component","timeSince","date","seconds","Math","floor","Date","getTime","interval","colors","HnComment","divRef","state","expandSelf","scrollIfDesired","dims","current","offsetTop","console","log","window","scrollTo","behavior","top","kidsObj","isValidComment","commentText","text","childrenToShow","className","dangerouslySetInnerHTML","__html","length","newIsOpen","borderColor","classNames","collapsed","onClick","e","handleCardClick","style","paddingLeft","max","marginLeft","borderLeftColor","borderLeftWidth","borderRight","paddingRight","fontWeight","by","time","stopPropagation","target","tagName","gutterRatio","pageX","offsetLeft","innerWidth","setState","deleted","HnPage","HnListSource","HnStoryPage","collapsedComments","anchorClickHandler","bind","data","storyData","storyLinkEl","title","href","comments","document","overflowWrap","score","handleCollapseEvent","newIds","_","cloneDeep","remove","sessionStorage","setItem","JSON","stringify","concat","body","addEventListener","strCollapsedIds","getItem","parse","onVisitMarker","removeEventListener","link","history","push","preventDefault","DataLayer","initializeFromLocalStorage","allItems","currentLists","isLoadingFresh","isLoadingNewData","activeList","activeStory","isLoadingLocalStorage","localStoragePromise","readItems","activeListType","activeStoryId","allItemsProm","localforage","currentListsProm","readItemsProm","localStorageProm","Promise","all","updateActiveList","updateActiveStory","newReadList","find","getStoryFromServer","updateIsLoadingStatus","fetch","response","ok","error","json","newItems","isLoading","clearItemData","getStoryData","newStory","itemRemoved","newData","before","after","itemsToCheck","strIds","collapseHash","Set","shift","has","delete","newCollapse","Array","from","source","idsToLoad","reloadStoryListFromServer","dataOut","stories","Front","sortBy","Day","Week","Month","updateNewItems","listType","newList","newDataList","listToUpdate","newAllItems","storiesToReturn","existingStoryIndex","existingStory","lastUpdated","saveNewDataToLocalStorage","story","Container","Header","marginBottom","Group","to","Heading","display","alignItems","src","color","activeClassName","align","size","intent","requestNewData","icon","minimal","PureComponent","HnListItem","commentCount","descendants","isRead","HnStoryList","items","action","scrollPos","isNaN","scrollY","readIds","_App","storyKey","activePage","STORY_LIST","STORY","GLOBAL_DATA_LAYER","prevProps","prevState","dataLayer","requestFreshDataFromDataLayer","saveIdToReadList","reloadStoryById","hnPage","storyId","params","page","App","withRouter","isLocalhost","Boolean","location","hostname","registerValidSW","swUrl","config","navigator","serviceWorker","register","then","registration","onupdatefound","installingWorker","installing","onstatechange","controller","onUpdate","onSuccess","catch","smoothscroll","polyfill","onerror","msg","lineNo","columnNo","localForage","clear","innerHTML","localStorage","ReactDOM","render","path","inject","getElementById","URL","process","origin","contentType","headers","get","status","indexOf","ready","unregister","reload","checkValidServiceWorker"],"mappings":"8ZAAO,SAASA,EAAUC,GACxB,QAAYC,IAARD,EACF,MAAO,GAET,IAAIE,EAAUF,EAAIG,MAAM,wCAExB,OADaD,GAAWA,EAAQ,G,oBCcrBE,EAAb,kDAEE,WAAYC,GAA4B,IAAD,8BACrC,cAAMA,IAFRC,UAA+C,GAG7CD,EAAME,cAAcC,SAAQ,SAACC,GACd,OAATA,IAGJ,EAAKH,UAAUG,EAAKC,IAAMC,IAAMC,gBANG,EAFzC,qDAWY,IAAD,OACDC,EAAgBC,KAAKT,MAAME,cAAcQ,QAC7C,SAACC,GAAD,OAAmB,OAATA,KAEZ,OACE,kBAAC,IAAMC,SAAP,KACGJ,EAAcK,KAAI,SAACC,EAAWC,GAAZ,OACjB,kBAAC,EAAD,CACEC,IAAKF,EAAWT,GAChBY,QAASH,EACTI,MAAO,EAAKlB,MAAMkB,MAClBC,UAAW,EAAKnB,MAAMmB,UACtBC,IAAK,EAAKnB,UAAUa,EAAWT,IAC/BgB,aAAc,SAAChB,EAAIiB,EAASC,GAAd,aACZ,EAAKvB,MAAMqB,aACThB,EACAiB,EAFF,OAGEC,QAHF,IAGEA,IACGD,EAAO,OAAGR,QAAH,IAAGA,OAAH,EAAGA,EAAWT,GAAd,UAAmBG,EAAcO,EAAQ,UAAzC,aAAmB,EAA0BV,KAG3DmB,SAEI,EAAKxB,MAAMyB,aAAaC,WACtB,SAACC,GAAD,OAAqB,OAAdb,GAAsBa,IAAMb,EAAUT,OAC1C,GAGToB,aAAc,EAAKzB,MAAMyB,aACzBG,aAAc,EAAK5B,MAAM4B,uBAxCrC,GAAmCtB,IAAMuB,WCnBlC,SAASC,EAAUC,GACxB,IAAIC,EAAUC,KAAKC,OAAM,IAAIC,MAAOC,UAAY,IAAOL,GACnDM,EAAWJ,KAAKC,MAAMF,EAAU,SACpC,OAAIK,EAAW,EACNA,EAAW,UAEpBA,EAAWJ,KAAKC,MAAMF,EAAU,SACjB,EACNK,EAAW,WAEpBA,EAAWJ,KAAKC,MAAMF,EAAU,QACjB,EACNK,EAAW,SAEpBA,EAAWJ,KAAKC,MAAMF,EAAU,QAChB,EACPK,EAAW,SAAWA,EAAW,EAAI,IAAM,KAEpDA,EAAWJ,KAAKC,MAAMF,EAAU,KACjB,EACNK,EAAW,WAEbJ,KAAKC,MAAMF,GAAW,WCI/B,IAAMM,EAAS,CACb,UACA,UACA,UACA,UACA,UACA,WAGWC,EAAb,kDAkCE,WAAYvC,GAAwB,IAAD,8BACjC,cAAMA,IAlCRwC,YAiCmC,EAGjC,EAAKC,MAAQ,CACXC,YAAY,GAGd,EAAKF,OAASlC,IAAMC,YAPa,EAlCrC,gEAIIE,KAAKkC,oBAJT,2CAQIlC,KAAKkC,oBART,wCAWqB,IAAD,EAChB,GAAIlC,KAAKT,MAAM4B,gBAAX,UAA4BnB,KAAKT,MAAMiB,eAAvC,aAA4B,EAAoBZ,IAAI,CAAC,IAAD,EAChDuC,EAAI,UAAGnC,KAAK+B,OAAOK,eAAf,aAAG,EAAqBC,UAClCC,QAAQC,IAAI,kBAAmBJ,QAElBhD,IAATgD,GACFK,OAAOC,SAAS,CAAEC,SAAU,SAAUC,IAAKR,EAAO,SAjB1D,gDAuBI5C,EACAyC,GAGA,OAAKzC,EAAMmB,UAIJ,KAHE,CAAEuB,YAAY,OA5B3B,iDA6CI,OAAOjC,KAAK+B,OAAOK,UA7CvB,+BAgDY,IAAD,OACD5B,EAAUR,KAAKT,MAAMiB,QAE3B,GAAgB,OAAZA,EACF,OAAO,KAGT,IAAMf,GAAiBe,EAAQoC,SAAW,IAAI3C,OAAO4C,GAC/CC,EAActC,EAAQuC,MAAQ,GAEpC,IAAKF,EAAerC,GAElB,OAAO,KAKT,IAAMwC,EAAkBhD,KAAKT,MAAMwB,OACjC,kBAAC,IAAMZ,SAAP,KACE,uBACE8C,UAAU,UACVC,wBAAyB,CAAEC,OAAQL,KAGpCrD,EAAc2D,OAAS,GACtB,kBAAC,EAAD,CACE3D,cAAeA,EACfiB,UAAWV,KAAKT,MAAMmB,YAAcV,KAAKgC,MAAMC,WAC/CxB,MAAOT,KAAKT,MAAMkB,MAAQ,EAC1BG,aAAc,SAAChB,EAAIyD,EAAWvC,GAAhB,OACZ,EAAKvB,MAAMqB,aAAahB,EAAIyD,EAAWvC,IAEzCE,aAAchB,KAAKT,MAAMyB,aACzBG,aAAcnB,KAAKT,MAAM4B,gBAhBW,KAsBtCmC,EACJtD,KAAKT,MAAMkB,MAAQoB,EAAOuB,OAASvB,EAAO7B,KAAKT,MAAMkB,OAAS,OAChE,OACE,yBACEwC,UAAWM,IAAW,WAAY,CAAEC,WAAYxD,KAAKT,MAAMwB,SAC3D0C,QAAS,SAACC,GAAD,OAAO,EAAKC,gBAAgBD,IACrCE,MAAO,CACLC,YAAa,GAAKrC,KAAKsC,IAAI,EAAI9D,KAAKT,MAAMkB,OAC1CsD,WACE/D,KAAKgC,MAAMC,YAAcjC,KAAKT,MAAMwB,QAC/B,GAAKf,KAAKT,MAAMkB,MACjB,EAENuD,gBAAiBV,EAEjBW,gBAAiBjE,KAAKgC,MAAMC,WAAa,OAAI9C,EAE7C+E,YAAalE,KAAKgC,MAAMC,WACpB,YAAcqB,OACdnE,EACJgF,aAAcnE,KAAKgC,MAAMC,WAAa,OAAI9C,IAG5C,uBACEyE,MAAO,CAAEQ,WAAYpE,KAAKT,MAAMwB,OAAS,IAAM,KAC/CJ,IAAKX,KAAK+B,QAETvB,EAAQ6D,GACR,MAEAhD,EAAUb,EAAQ8D,MAClB,QAGFtB,KAzHT,sCA6HkBU,GAMd,GAHAA,EAAEa,kBAGgC,MAA7Bb,EAAEc,OAAeC,QAAtB,CAIA,IAAMD,EAASd,EAAEc,OAGXE,EAAc1E,KAAKgC,MAAMC,WAAa,IAAO,GAEnD,GACEjC,KAAKT,MAAMkB,MAAQ,GACnBT,KAAKT,MAAMmB,YACVgD,EAAEiB,MAAQH,EAAOI,YAAcpC,OAAOqC,WAAaH,EAEpD1E,KAAK8E,SAAS,CAAE7C,YAAajC,KAAKgC,MAAMC,iBACnC,CACL,IAAMlB,GAAUf,KAAKT,MAAMwB,OAE3B,GAA2B,OAAvBf,KAAKT,MAAMiB,QACb,OAGFR,KAAKT,MAAMqB,aAAaZ,KAAKT,MAAMiB,QAAQZ,GAAImB,OAAQ5B,SAzJ7D,GAA+BU,IAAMuB,WA8J9B,SAASyB,EAAerC,GAC7B,OAAgB,OAAZA,KAIFA,EAAQuE,eACa5F,IAApBqB,EAAQoC,SAAqD,IAA5BpC,EAAQoC,QAASQ,SC/KhD,ICTF4B,EAKOC,EDKCC,EAAb,kDAIE,WAAY3F,GAA0B,IAAD,8BACnC,cAAMA,IAEDyC,MAAQ,CACXmD,kBAAmB,GACnBhE,kBAAchC,GAGhB,EAAKiG,mBAAqB,EAAKA,mBAAmBC,KAAxB,gBARS,EAJvC,qDAeY,IAAD,OACP,QAAwBlG,IAApBa,KAAKT,MAAM+F,KACb,OAAO,KAGThD,QAAQC,IAAI,eAAgBvC,KAAKgC,MAAMb,cAEvC,IAAMoE,EAAYvF,KAAKT,MAAM+F,KAEvBE,OACcrG,IAAlBoG,EAAUrG,IACR,8BAAOqG,EAAUE,OAEjB,uBAAGC,KAAMH,EAAUrG,KAAMqG,EAAUE,OAGjCE,GAAYJ,EAAU3C,SAAW,IAAI3C,OAAO4C,GAIlD,OAFA+C,SAASH,MAAT,cAAwBF,EAAUE,OAGhC,6BACE,kBAAC,IAAD,CAAI7B,MAAO,CAAEiC,aAAc,eAAiBL,GAC5C,kBAAC,IAAD,KACE,8BAAOD,EAAUlB,IACjB,8BAAO,OACP,8BACGkB,EAAUO,MACV,WAEH,8BAAO,OACP,8BAAOzE,EAAUkE,EAAUjB,MAA3B,QACA,8BAAO,OACP,8BAAOrF,EAAUsG,EAAUrG,YAETC,IAAnBoG,EAAUxC,MACT,uBACEE,UAAU,WACVC,wBAAyB,CAAEC,OAAQoC,EAAUxC,QAIjD,kBAAC,EAAD,CACEtD,cAAekG,EACfjF,WAAW,EACXD,MAAO,EACPO,aAAchB,KAAKgC,MAAMmD,kBACzBvE,aAAc,SAAChB,EAAIiB,EAASC,GAAd,OACZ,EAAKiF,oBAAoBnG,EAAIiB,EAASC,IAExCK,aAAcnB,KAAKgC,MAAMb,kBAjEnC,0CAuEIvB,EACAiB,EACAC,GAIA,GAAID,EAAS,CAEX,IAAMmF,EAASC,IAAEC,UAAUlG,KAAKgC,MAAMmD,mBACtCc,IAAEE,OAAOH,GAAQ,SAAC9E,GAAD,OAAOA,IAAMtB,KAE9BwG,eAAeC,QAnFY,oBAmFeC,KAAKC,UAAUP,IACzDhG,KAAK8E,SAAS,CAAEK,kBAAmBa,QAC9B,CACL,IAAMA,EAAShG,KAAKgC,MAAMmD,kBAAkBqB,OAAO5G,GAEnDwG,eAAeC,QAxFY,oBAwFeC,KAAKC,UAAUP,IACzDhG,KAAK8E,SAAS,CAAEK,kBAAmBa,SAGpB7G,IAAb2B,GACFd,KAAK8E,SAAS,CAAE3D,aAAcL,MA5FpC,0CAiGI0B,OAAOC,SAAS,CAAEE,IAAK,IAIvBiD,SAASa,KAAKC,iBAAiB,QAAS1G,KAAKoF,oBAE7C,IAAMuB,EAAkBP,eAAeQ,QAxGV,qBA2G7B,GAAwB,OAApBD,EAA0B,CAC5B,IAAM3F,EAAesF,KAAKO,MAAMF,GAEhC3G,KAAK8E,SAAS,CAAEK,kBAAmBnE,SAKf7B,IAAlBa,KAAKT,MAAMK,IACbI,KAAKT,MAAMuH,cAAc9G,KAAKT,MAAMK,MAnH1C,6CAwHIgG,SAASa,KAAKM,oBAAoB,QAAS/G,KAAKoF,sBAxHpD,yCA0HqB1B,GACjB,GAAyB,MAArBA,EAAEc,OAAOC,QAAb,CAMA,IAAMuC,EAAOtD,EAAEc,OAGTpF,EAAU4H,EAAKtB,KAAKrG,MADZ,qDAGd,GAAgB,OAAZD,EASJ,OAHAY,KAAKT,MAAM0H,QAAQC,KAAK,UAAY9H,EAAQ,IAE5CsE,EAAEyD,kBACK,EARLH,EAAKxC,OAAS,cAvIpB,GAAiC3E,IAAMuB,WEQ1BgG,EAAb,kDACE,aAAe,IAAD,8BACZ,gBAIKC,6BAGL,EAAKrF,MAAQ,CACXsF,SAAU,GACVC,aAAc,GACdC,gBAAgB,EAChBC,kBAAkB,EAClBC,WAAY,GACZC,iBAAaxI,EACbyI,uBAAuB,EACvBC,yBAAqB1I,EACrB2I,UAAW,GACXC,oBAAgB5I,EAChB6I,mBAAe7I,GAnBL,EADhB,gNAyBImD,QAAQC,IAAI,8BACZvC,KAAK8E,SAAS,CAAE8C,uBAAuB,IAEjCK,EAAeC,IAAYtB,QA/Bb,gBAgCduB,EAAmBD,IAAYtB,QA/BhB,iBAgCfwB,EAAgBF,IAAYtB,QA/Bb,sBAiCfyB,EAAmBC,QAAQC,IAAI,CACnCN,EACAE,EACAC,IAIFpI,KAAK8E,SAAS,CAAE+C,oBAAqBQ,IAvCzC,SAyCsDA,EAzCtD,0CAyCWf,EAzCX,KAyCqBC,EAzCrB,KAyCmCO,EAzCnC,KA2CIxF,QAAQC,IAAI,4BAA6B+E,EAAUC,GA3CvD,UA4CyBvH,KAAK8E,SAAS,CACjCwC,SAAQ,OAAEA,QAAF,IAAEA,IAAY,GACtBC,aAAY,OAAEA,QAAF,IAAEA,IAAgB,GAC9BK,uBAAuB,EACvBC,yBAAqB1I,EACrB2I,UAAS,OAAEA,QAAF,IAAEA,IAAa,KAjD9B,oBAoDsC3I,IAA9Ba,KAAKgC,MAAM+F,gBACb/H,KAAKwI,iBAAiBxI,KAAKgC,MAAM+F,qBAGF5I,IAA7Ba,KAAKgC,MAAMgG,eACbhI,KAAKyI,kBAAkBzI,KAAKgC,MAAMgG,eAzDxC,8IA6DmBpI,GACf,IAAM8I,EAAczC,IAAEC,UAAUlG,KAAKgC,MAAM8F,WAC3CxF,QAAQC,IAAI,gBAAiBmG,GAGzBA,EAAY9I,KAIhB8I,EAAY9I,IAAM,EAElBsI,IAAY7B,QAzES,qBAyEiBqC,GACtC1I,KAAK8E,SAAS,CAAEgD,UAAWY,OAzE/B,4EA4EqB9I,GA5ErB,+EA8EiBT,KADTQ,EAAOK,KAAKgC,MAAMsF,SAASqB,MAAK,SAACzH,GAAD,OAAOA,EAAEtB,KAAOA,MA7ExD,yCA+EaD,GA/Eb,uBAmFiBK,KAAK4I,mBAAmBhJ,GAnFzC,iOAsFkCA,GAtFlC,oFAuFQV,EAAM,cAAgBU,EAE1BI,KAAK6I,uBAAsB,GAzF/B,SA0F2BC,MAAM5J,GA1FjC,WA0FU6J,EA1FV,QA2FkBC,GA3FlB,uBA4FM1G,QAAQ2G,MAAMF,GA5FpB,uBA6Fa5J,GA7Fb,wBA+FmD4J,EAASG,OA/F5D,aAiGQ,UAFE5D,EA/FV,iCAkGMhD,QAAQ2G,MAAM3D,GACdtF,KAAK6I,uBAAsB,GAnGjC,uBAoGa1J,GApGb,eAuGImD,QAAQC,IAAI,sBAAuB+C,GAEnCtF,KAAK6I,uBAAsB,GAGrBM,EAAWnJ,KAAKgC,MAAMsF,SAASd,OAAOlB,GAC5CtF,KAAK8E,SAAS,CAAEwC,SAAU6B,IA7G9B,kBA8GW7D,GA9GX,oJAgHwB8D,GACpBpJ,KAAK8E,SAAS,CAAE2C,iBAAkB2B,MAjHtC,+EAoHwBxJ,GApHxB,8EAqHII,KAAKqJ,cAAczJ,GArHvB,SAuH2BI,KAAKsJ,aAAa1J,GAvH7C,OAuHU2J,EAvHV,OAwHIvJ,KAAK8E,SAAS,CAAE6C,YAAa4B,IAxHjC,2IA2HgB3J,GACZ,IAAM4J,EAAcxJ,KAAKgC,MAAMsF,SAASqB,MAAK,SAACzH,GAAD,OAAOA,EAAEtB,KAAOA,KAEvD6J,EAAUzJ,KAAKgC,MAAMsF,SAASrH,QAAO,SAACiB,GAAD,OAAOA,EAAEtB,KAAOA,KAC3D0C,QAAQC,IAAI,aAAc,CACxBmH,OAAQ1J,KAAKgC,MAAMsF,SAASlE,OAC5BuG,MAAOF,EAAQrG,cAIGjE,IAAhBqK,GAA4B,WAG9B,IAAMI,EAAsC,CAACJ,GAEvCK,EAASzD,eAAeQ,QFnJH,qBEqJ3B,GAAe,OAAXiD,EAAiB,CAKnB,IAJA,IAAM7I,EAAesF,KAAKO,MAAMgD,GAE1BC,EAAe,IAAIC,IAAI/I,GAEtB4I,EAAaxG,QAAQ,CAAC,IAAD,EACpBzD,EAAOiK,EAAaI,aAEb7K,IAATQ,IAKAmK,EAAaG,IAAItK,EAAKC,KACxBkK,EAAaI,OAAOvK,EAAKC,IAG3B,UAAAD,EAAKiD,eAAL,SACI3C,QAAO,SAACiB,GAAD,OAAa,OAANA,KACfxB,SAAQ,SAACwB,GAAD,OAAO0I,EAAa1C,KAAKhG,OAGtC,IAAMiJ,EAAcC,MAAMC,KAAKP,GAE/BxH,QAAQC,IAAI,eAAgBvB,EAAcmJ,GAE1C/D,eAAeC,QF/KU,oBE+KiBC,KAAKC,UAAU4D,KAjC7B,GAqChCnK,KAAK8E,SAAS,CAAEwC,SAAUmC,MA1K9B,gFA6KyBa,GA7KzB,mFAgLItK,KAAK8E,SAAS,CAAEiD,eAAgBuC,IAEhChI,QAAQC,IAAI,cAAe+H,EAAQtK,KAAKgC,YAEzB7C,IAAXmL,EApLR,uBAqLMhI,QAAQ2G,MAAM,8BArLpB,kBAsLa,IAtLb,WAyLQjJ,KAAKgC,MAAM4F,sBAzLnB,uBA0LMtF,QAAQC,IAAI,wCA1LlB,kBA2La,IA3Lb,WA8LQvC,KAAKgC,MAAM6F,oBA9LnB,wBA+LMvF,QAAQC,IAAI,oCA/LlB,UAgMYvC,KAAKgC,MAAM6F,oBAhMvB,QAiMMvF,QAAQC,IAAI,wBAjMlB,gBAsMsBpD,KAFZoL,EAAYvK,KAAKgC,MAAMuF,aAAaoB,MAAK,SAACzH,GAAD,OAAOA,EAAEX,MAAQ+J,MApMpE,wBAuMMhI,QAAQC,IAAI,qBACZvC,KAAKwK,0BAA0BF,GAxMrC,2BA4MQG,EAAUF,EAAUG,QACrBtK,KAAI,SAACR,GAAD,OAAQ,EAAKoC,MAAMsF,SAASqB,MAAK,SAACzH,GAAD,OAAOA,EAAEtB,KAAOA,QACrDK,QAAO,SAACiB,GAAD,YAAa/B,IAAN+B,KAEboJ,IAAWrF,EAAa0F,QAC1BF,EAAUxE,IAAE2E,OAAOH,GAAS,SAACvJ,GAAD,OAAQA,EAAE4E,UAGxC9F,KAAK8E,SAAS,CAAE4C,WAAY+C,IApNhC,iMAuNyC/C,GAvNzC,2EAwNIpF,QAAQC,IAAI,gBACRrD,EAAM,GAzNd,KA0NYwI,EA1NZ,cA2NWzC,EAAa0F,MA3NxB,SA8NW1F,EAAa4F,IA9NxB,SAiOW5F,EAAa6F,KAjOxB,SAoOW7F,EAAa8F,MApOxB,0BA4NQ7L,EAAM,yBA5Nd,mCA+NQA,EAAM,kBA/Nd,mCAkOQA,EAAM,mBAlOd,oCAqOQA,EAAM,oBArOd,iCAyOQc,KAAKgC,MAAMyF,iBAzOnB,wBA0OMnF,QAAQC,IAAI,mCA1OlB,kCA8OIvC,KAAK6I,uBAAsB,GA9O/B,UAgP2BC,MAAM5J,GAhPjC,YAgPU6J,EAhPV,QAiPkBC,GAjPlB,wBAkPM1G,QAAQ2G,MAAMF,GACd/I,KAAK6I,uBAAsB,GAnPjC,4CAuP+BE,EAASG,OAvPxC,QAuPQ5D,EAvPR,OAyPQoC,IAAezC,EAAa0F,QAE9BrF,EAAOW,IAAE2E,OAAetF,GAAM,SAACpE,GAAD,OAAQA,EAAE4E,UAM1CxD,QAAQC,IAAI,uBAAwB+C,GAEpCtF,KAAK6I,uBAAsB,GAE3B7I,KAAKgL,eAAe1F,EAAMoC,GArQ9B,6IAwQiBpC,EAA4B2F,GACzC3I,QAAQC,IAAI,2BAA4B+C,EAAM2F,EAAUjL,KAAKgC,YAEhD7C,IAATmG,IACFA,EAAO,IAIT,IAAM4F,EAAU5F,EAAKlF,KAAI,SAACc,GAAD,OAAOA,EAAEtB,MAE5BuL,EAAclF,IAAEC,UAAUlG,KAAKgC,MAAMuF,cAEvC6D,EAAeD,EAAYxC,MAAK,SAACzH,GAAD,OAAOA,EAAEX,MAAQ0K,UAEhC9L,IAAjBiM,EACFD,EAAYjE,KAAK,CACf3G,IAAK0K,EACLP,QAASQ,IAGXE,EAAaV,QAAUQ,EAKzB,IAAMG,EAAcpF,IAAEC,UAAUlG,KAAKgC,MAAMsF,UAErCgE,EAA4B,GAElChG,EAAK5F,SAAQ,SAAC6J,GACZ,IAAMgC,EAAqBF,EAAYpK,WACrC,SAACC,GAAD,OAAOA,EAAEtB,KAAO2J,EAAS3J,MAI3B,IAA4B,IAAxB2L,EAGF,OAFAF,EAAYnE,KAAKqC,QACjB+B,EAAgBpE,KAAKqC,GAKvB,IAAMiC,EAAgBH,EAAYE,GAC9BC,EAAcC,YAAclC,EAASkC,YACvCH,EAAgBpE,KAAKsE,IAIvBH,EAAYE,GAAsBhC,EAClC+B,EAAgBpE,KAAKqC,OAOvBvJ,KAAK0L,0BAA0BL,EAAaF,GAE5CnL,KAAK8E,SAAS,CACZwC,SAAU+D,EACV9D,aAAc4D,EACdzD,WAAYpC,MArUlB,gDAwU4B+F,EAAuBF,GAC/CjD,IAAY7B,QA5UQ,eA4UiBgF,GACrCnD,IAAY7B,QA5US,gBA4UiB8E,KA1U1C,iFA6U0BnD,GA7U1B,0EA8UIhI,KAAK8E,SAAS,CAAEkD,cAAeA,SAET7I,IAAlB6I,EAhVR,uBAiVMhI,KAAK8E,SAAS,CAAE6C,iBAAaxI,IAjVnC,8BAqVQa,KAAKgC,MAAM4F,sBArVnB,uBAsVMtF,QAAQC,IAAI,iDAtVlB,0CA0VwBvC,KAAKsJ,aAAatB,GA1V1C,OA0VU2D,EA1VV,OA4VI3L,KAAK8E,SAAS,CAAE6C,YAAagE,IA5VjC,6GAA+BC,K,wBCxBlBC,EAAb,uKACY,IAAD,OACP,OACE,kBAAC,IAAD,CAAQjI,MAAO,CAAEkI,aAAc,KAC7B,kBAAC,IAAOC,MAAR,KACE,kBAAC,IAAD,CAAMC,GAAG,IAAI/I,UAAU,uCACrB,kBAAC,IAAOgJ,QAAR,CAAgBrI,MAAO,CAAEsI,QAAS,OAAQC,WAAY,WACpD,yBAAKC,IAAI,sBACT,0BAAMxI,MAAO,CAAEG,WAAY,EAAGsI,MAAO,YAArC,aAIJ,kBAAC,IAAD,CACEL,GAAG,OACH/I,UAAU,sCACVqJ,gBAAgB,iCAHlB,OAOA,kBAAC,IAAD,CACEN,GAAG,QACH/I,UAAU,sCACVqJ,gBAAgB,iCAHlB,QAOA,kBAAC,IAAD,CACEN,GAAG,SACH/I,UAAU,sCACVqJ,gBAAgB,iCAHlB,UASF,kBAAC,IAAOP,MAAR,CAAcQ,MAAM,SACjBvM,KAAKT,MAAM6J,WAAa,kBAAC,IAAD,CAASoD,KAAM,MACtCxM,KAAKT,MAAM6J,WACX,kBAAC,IAAD,CACEqD,OAAO,UACPhJ,QAAS,kBAAM,EAAKlE,MAAMmN,kBAC1BC,KAAK,UACLC,SAAS,UA1CvB,GAA4B/M,IAAMgN,e,QCKrBC,EAAb,uKAEI,IAAMnB,EAAQ3L,KAAKT,MAAM+F,KAEnByH,EACJ,kBAAC,IAAM5M,SAAP,KACG,MACD,kBAAC,IAAD,CAAM6L,GAAI,UAAYL,EAAM/L,IAC1B,kBAAC,IAAD,CAAM+M,KAAK,YADb,IAC2BhB,EAAMqB,cAK/BxH,OACUrG,IAAdwM,EAAMzM,IACJ,kBAAC,IAAD,CAAM8M,GAAI,UAAYL,EAAM/L,IAAK+L,EAAMlG,OAEvC,uBAAGC,KAAMiG,EAAMzM,IAAKsF,OAAO,UACxBmH,EAAMlG,OAIb,OACE,yBAAKxC,UAAWM,IAAW,CAAE0J,OAAQjN,KAAKT,MAAM0N,UAC9C,2BAAIzH,GACJ,2BACE,8BACE,kBAAC,IAAD,CAAMmH,KAAK,eADb,IAC8B,IAAMhB,EAAM7F,YAEnB3G,IAAtBwM,EAAMqB,aAA6BD,EACpC,8BAAO,MAAQ1L,EAAUsK,EAAMrH,MAAQ,QACvC,8BAAO,MAAQrF,EAAU0M,EAAMzM,YA/BzC,GAAgCW,IAAMuB,WCDzB8L,EAAb,kDACE,WAAY3N,GAA0B,IAAD,8BACnC,cAAMA,IACDyC,MAAQ,CACXmL,MAAO,IAH0B,EADvC,gEAUI,IAAMlG,EAAUjH,KAAKT,MAAM0H,QAG3B,GAFA3E,QAAQC,IAAI,mBAAoB0E,GAET,QAAnBA,EAAQmG,OAAkB,CAE5B,IAAMC,GAAajH,eAAeQ,QAhBjB,eAkBZ0G,MAAMD,KACT/K,QAAQC,IAAI,kBAAmB8K,GAC/B7K,OAAOC,SAAS,CAAEE,IAAK0K,QAnB/B,6CAyBI/K,QAAQC,IAAI,kBAAmBC,OAAO+K,SAEtCnH,eAAeC,QA5BI,cA4BoB,GAAK7D,OAAO+K,WA3BvD,+BA8BY,IAAD,OAEP,OADA3H,SAASH,MAAT,cAEE,6BACGzF,KAAKT,MAAM4N,MACTlN,QAAO,SAAC0L,GAAD,YAAiCxM,IAAtBwM,EAAMqB,eACxB5M,KAAI,SAACT,GAAD,OACH,kBAAC,EAAD,CACE2F,KAAM3F,EACNY,IAAKZ,EAAKC,GACVqN,OAAQ,EAAK1N,MAAMiO,QAAQ7N,EAAKC,cAxC9C,GAAiCC,IAAMuB,Y,SJElC4D,O,2BAAAA,I,kBAAAA,M,cAKOC,O,iBAAAA,I,aAAAA,I,eAAAA,I,kBAAAA,M,SAmBNwI,E,kDACJ,WAAYlO,GAAsB,IAAD,8BAC/B,cAAMA,IAEDyC,MAAQ,CACX0F,WAAYzC,EAAa0F,MACzB+C,SAAU,EACVC,WAAY3I,EAAO4I,WACnB5F,mBAAe7I,GAPc,E,+KA8DvBa,KAAKgC,MAAM2L,W,cACZ3I,EAAO6I,M,SAIP7I,EAAO4I,W,wBAHVE,EAAkBrF,kBAAkBzI,KAAKgC,MAAMgG,e,kCAI/C8F,EAAkBtF,iBAAiBxI,KAAKgC,MAAM0F,Y,4MAK3BqG,EAAyBC,G,iEAC1BA,EAAUtG,aAAe1H,KAAKgC,MAAM0F,YAIxDoG,EAAkBtF,iBAAiBxI,KAAKgC,MAAM0F,YAI9CsG,EAAUhG,gBAAkBhI,KAAKgC,MAAMgG,eAGvC8F,EAAkBrF,kBAAkBzI,KAAKgC,MAAMgG,e,wIAIzC,IAAD,OACP,OACE,kBAAC,IAAD,CAAWgE,GAAI,CAAC5E,KACb,SAAC6G,GAAD,OACC,6BACE,kBAAC,EAAD,CACEvB,eAAgB,kBAAM,EAAKwB,iCAC3B9E,UAAW6E,EAAUjM,MAAMyF,mBAE5B,EAAKzF,MAAM2L,aAAe3I,EAAO6I,OAChC,kBAAC,EAAD,CACEjO,GAAI,EAAKoC,MAAMgG,cACff,QAAS,EAAK1H,MAAM0H,QACpB1G,IAAK,EAAKyB,MAAMgG,cAAgB,IAAM,EAAKhG,MAAM0L,SACjD5G,cAAe,SAAClH,GAAD,OAAQqO,EAAUE,iBAAiBvO,IAClD0F,KAAM2I,EAAUjM,MAAM2F,cAGzB,EAAK3F,MAAM2L,aAAe3I,EAAO4I,YAChC,kBAAC,EAAD,CACET,MAAOc,EAAUjM,MAAM0F,WACvB8F,QAASS,EAAUjM,MAAM8F,UACzBb,QAAS,EAAK1H,MAAM0H,gB,sDAShC,OAAQjH,KAAKgC,MAAM2L,YACjB,KAAK3I,EAAO6I,WACuB1O,IAA7Ba,KAAKgC,MAAMgG,gBACb1F,QAAQC,IAAI,0BACZuL,EAAkBM,gBAAgBpO,KAAKgC,MAAMgG,gBAE/C,MACF,KAAKhD,EAAO4I,WACVtL,QAAQC,IAAI,yBACZuL,EAAkBtD,0BAA0BxK,KAAKgC,MAAM0F,gB,gDAvH7BnI,EAAqByC,GAAkB,IAAD,EAChEiJ,EACAoD,EACAC,OAA8BnP,EAElCmD,QAAQC,IAAI,aAAchD,EAAMF,MAAMkP,OAAOC,MAE7C,IAAMA,OAC2BrP,IAA/BI,EAAMF,MAAMkP,OAAOD,QACf/O,EAAMF,MAAMkP,OAAOC,KACnB,QAGN,OADAlM,QAAQC,IAAIhD,EAAMF,MAAOmP,GACjBA,GACN,IAAK,MACHvD,EAAWhG,EAAa4F,IACxBwD,EAASrJ,EAAO4I,WAChB,MAEF,IAAK,OACH3C,EAAWhG,EAAa6F,KACxBuD,EAASrJ,EAAO4I,WAChB,MAEF,IAAK,QACH3C,EAAWhG,EAAa8F,MACxBsD,EAASrJ,EAAO4I,WAChB,MAEF,IAAK,QACHS,EAASrJ,EAAO6I,MAChBS,IAAU,UAAE/O,EAAMF,MAAMkP,OAAOD,eAArB,QAAgC,IAC1CrD,EAAWjJ,EAAM0F,WACjB,MAEF,QACEuD,EAAWhG,EAAa0F,MACxB0D,EAASrJ,EAAO4I,WAMpB,OAFAtL,QAAQC,IAAI,gBAAiBhD,EAAMF,MAAMkP,OAAQtD,EAAUoD,EAAQC,GAE5D,CACL5G,WAAYuD,EACZ0C,WAAYU,EACZrG,cAAesG,O,GAzDFzO,IAAMuB,WAwIZqN,EAAMC,YAAWjB,GKnKxBkB,EAAcC,QACW,cAA7BpM,OAAOqM,SAASC,UAEe,UAA7BtM,OAAOqM,SAASC,UAEhBtM,OAAOqM,SAASC,SAASzP,MACvB,2DA8CN,SAAS0P,EAAgBC,EAAeC,GACtCC,UAAUC,cACPC,SAASJ,GACTK,MAAK,SAAAC,GACJA,EAAaC,cAAgB,WAC3B,IAAMC,EAAmBF,EAAaG,WACd,MAApBD,IAGJA,EAAiBE,cAAgB,WACA,cAA3BF,EAAiBxN,QACfkN,UAAUC,cAAcQ,YAI1BrN,QAAQC,IACN,gHAKE0M,GAAUA,EAAOW,UACnBX,EAAOW,SAASN,KAMlBhN,QAAQC,IAAI,sCAGR0M,GAAUA,EAAOY,WACnBZ,EAAOY,UAAUP,WAO5BQ,OAAM,SAAA7G,GACL3G,QAAQ2G,MAAM,4CAA6CA,MCzFjE8G,IAAaC,WAEbxN,OAAOyN,QAAU,SAAUC,EAAKhR,EAAKiR,EAAQC,EAAUnH,GAErD3G,QAAQ2G,MAAM,cAAeiH,GAC7BG,IAAYC,QAEZ1K,SAASa,KAAK8J,UACZ,8FAKY,OADAC,aAAa5J,QAAQ,YAEnCyJ,IAAYC,QAGdE,aAAanK,QAAQ,UAAW,OAEzB,IAAMyH,EAAoB,IAAI1G,EAErCqJ,IAASC,OACP,kBAAC,IAAD,KACE,kBAAC,IAAD,CAAOC,KAAM,CAAC,kBAAmB,YAC/B,kBAAC,IAAD,CAAUC,OAAQ,CAAC9C,IACjB,kBAAC,EAAD,SAINlI,SAASiL,eAAe,SDjBnB,SAAkB5B,GACvB,GAA6C,kBAAmBC,UAAW,CAMzE,GAJkB,IAAI4B,IACnBC,GACDvO,OAAOqM,SAASnJ,MAEJsL,SAAWxO,OAAOqM,SAASmC,OAIvC,OAGFxO,OAAOkE,iBAAiB,QAAQ,WAC9B,IAAMsI,EAAK,UAAM+B,GAAN,sBAEPpC,IAgEV,SAAiCK,EAAeC,GAE9CnG,MAAMkG,GACHK,MAAK,SAAAtG,GAEJ,IAAMkI,EAAclI,EAASmI,QAAQC,IAAI,gBAEnB,MAApBpI,EAASqI,QACO,MAAfH,IAA8D,IAAvCA,EAAYI,QAAQ,cAG5CnC,UAAUC,cAAcmC,MAAMjC,MAAK,SAAAC,GACjCA,EAAaiC,aAAalC,MAAK,WAC7B7M,OAAOqM,SAAS2C,eAKpBzC,EAAgBC,EAAOC,MAG1Ba,OAAM,WACLxN,QAAQC,IACN,oEArFAkP,CAAwBzC,EAAOC,GAI/BC,UAAUC,cAAcmC,MAAMjC,MAAK,WACjC/M,QAAQC,IACN,gHAMJwM,EAAgBC,EAAOC,OCR/BE,K","file":"static/js/main.6d569884.chunk.js","sourcesContent":["export function getDomain(url: string | undefined) {\n  if (url === undefined) {\n    return \"\";\n  }\n  var matches = url.match(/^https?\\:\\/\\/([^\\/?#]+)(?:[\\/?#]|$)/i);\n  var domain = matches && matches[1];\n  return domain;\n}\n","import React from \"react\";\n\nimport { HnComment } from \"./HnComment\";\n\ninterface HnCommentListProps {\n  childComments: Array<KidsObj3 | null>;\n  depth: number;\n  canExpand: boolean;\n\n  onUpdateOpen(\n    id: number,\n    newOpen: boolean,\n    scrollId: number | undefined\n  ): void;\n\n  collapsedIds: number[];\n  idToScrollTo: number | undefined;\n}\n\nexport class HnCommentList extends React.Component<HnCommentListProps, {}> {\n  childRefs: Array<React.RefObject<HnComment>> = [];\n  constructor(props: HnCommentListProps) {\n    super(props);\n    props.childComments.forEach((item) => {\n      if (item === null) {\n        return;\n      }\n      this.childRefs[item.id] = React.createRef();\n    });\n  }\n  render() {\n    const validChildren = this.props.childComments.filter(\n      (comm) => comm !== null\n    );\n    return (\n      <React.Fragment>\n        {validChildren.map((childComm, index) => (\n          <HnComment\n            key={childComm!.id}\n            comment={childComm}\n            depth={this.props.depth}\n            canExpand={this.props.canExpand}\n            ref={this.childRefs[childComm!.id]}\n            onUpdateOpen={(id, newOpen, scrollId) =>\n              this.props.onUpdateOpen(\n                id,\n                newOpen,\n                scrollId ??\n                  (newOpen ? childComm?.id : validChildren[index + 1]?.id)\n              )\n            }\n            isOpen={\n              !(\n                this.props.collapsedIds.findIndex(\n                  (c) => childComm !== null && c === childComm.id\n                ) >= 0\n              )\n            }\n            collapsedIds={this.props.collapsedIds}\n            idToScrollTo={this.props.idToScrollTo}\n          />\n        ))}\n      </React.Fragment>\n    );\n  }\n}\n","export function timeSince(date: number) {\n  var seconds = Math.floor(new Date().getTime() / 1000 - date);\n  var interval = Math.floor(seconds / 31536000);\n  if (interval > 1) {\n    return interval + \" years\";\n  }\n  interval = Math.floor(seconds / 2592000);\n  if (interval > 1) {\n    return interval + \" months\";\n  }\n  interval = Math.floor(seconds / 86400);\n  if (interval > 1) {\n    return interval + \" days\";\n  }\n  interval = Math.floor(seconds / 3600);\n  if (interval >= 1) {\n    return interval + \" hour\" + (interval > 1 ? \"s\" : \"\");\n  }\n  interval = Math.floor(seconds / 60);\n  if (interval > 1) {\n    return interval + \" minutes\";\n  }\n  return Math.floor(seconds) + \" seconds\";\n}\n","import classNames from \"classnames\";\nimport React from \"react\";\n\nimport { HnCommentList } from \"./HnCommentList\";\nimport { timeSince } from \"./timeSince\";\n\nexport interface HnCommentProps {\n  comment: KidsObj3 | null;\n  depth: number;\n\n  canExpand: boolean;\n\n  isOpen: boolean;\n  onUpdateOpen(\n    id: number,\n    newIsOpen: boolean,\n    scrollId: number | undefined\n  ): void;\n  collapsedIds: number[];\n  idToScrollTo: number | undefined;\n}\n\ninterface HnCommentState {\n  expandSelf: boolean;\n}\n\nconst colors = [\n  \"#bc8672\",\n  \"#c5be53\",\n  \"#d46850\",\n  \"#8c7f3b\",\n  \"#dec392\",\n  \"#c9893a\",\n];\n\nexport class HnComment extends React.Component<HnCommentProps, HnCommentState> {\n  divRef: React.RefObject<HTMLDivElement>;\n\n  componentDidMount() {\n    this.scrollIfDesired();\n  }\n\n  componentDidUpdate() {\n    this.scrollIfDesired();\n  }\n\n  scrollIfDesired() {\n    if (this.props.idToScrollTo === this.props.comment?.id) {\n      const dims = this.divRef.current?.offsetTop;\n      console.log(\"scrolling to me\", dims);\n\n      if (dims !== undefined) {\n        window.scrollTo({ behavior: \"smooth\", top: dims - 80 });\n      }\n    }\n  }\n\n  static getDerivedStateFromProps(\n    props: HnCommentProps,\n    state: HnCommentState\n  ) {\n    // if a parent expands, collapse this one\n    if (!props.canExpand) {\n      return { expandSelf: false };\n    }\n\n    return null;\n  }\n\n  constructor(props: HnCommentProps) {\n    super(props);\n\n    this.state = {\n      expandSelf: false,\n    };\n\n    this.divRef = React.createRef();\n  }\n\n  getDivRef() {\n    return this.divRef.current!;\n  }\n\n  render() {\n    const comment = this.props.comment;\n\n    if (comment === null) {\n      return null;\n    }\n\n    const childComments = (comment.kidsObj || []).filter(isValidComment);\n    const commentText = comment.text || \"\";\n\n    if (!isValidComment(comment)) {\n      // kick out nothing if the comment was deleted and has no children\n      return null;\n    }\n\n    // TODO: rewrite links to hn to open in this site instead\n\n    const childrenToShow = !this.props.isOpen ? null : (\n      <React.Fragment>\n        <p\n          className=\"comment\"\n          dangerouslySetInnerHTML={{ __html: commentText }}\n        />\n\n        {childComments.length > 0 && (\n          <HnCommentList\n            childComments={childComments}\n            canExpand={this.props.canExpand && !this.state.expandSelf}\n            depth={this.props.depth + 1}\n            onUpdateOpen={(id, newIsOpen, scrollId) =>\n              this.props.onUpdateOpen(id, newIsOpen, scrollId)\n            }\n            collapsedIds={this.props.collapsedIds}\n            idToScrollTo={this.props.idToScrollTo}\n          />\n        )}\n      </React.Fragment>\n    );\n\n    const borderColor =\n      this.props.depth < colors.length ? colors[this.props.depth] : \"#bbb\";\n    return (\n      <div\n        className={classNames(\"bp3-card\", { collapsed: !this.props.isOpen })}\n        onClick={(e) => this.handleCardClick(e)}\n        style={{\n          paddingLeft: 12 + Math.max(4 - this.props.depth),\n          marginLeft:\n            this.state.expandSelf && this.props.isOpen\n              ? -17 * this.props.depth\n              : 0,\n\n          borderLeftColor: borderColor,\n\n          borderLeftWidth: this.state.expandSelf ? 6 : undefined,\n\n          borderRight: this.state.expandSelf\n            ? \"1px solid\" + borderColor\n            : undefined,\n          paddingRight: this.state.expandSelf ? 6 : undefined,\n        }}\n      >\n        <p\n          style={{ fontWeight: this.props.isOpen ? 450 : 300 }}\n          ref={this.divRef}\n        >\n          {comment.by}\n          {\" | \"}\n\n          {timeSince(comment.time)}\n          {\" ago\"}\n        </p>\n\n        {childrenToShow}\n      </div>\n    );\n  }\n  handleCardClick(e: React.MouseEvent<HTMLDivElement>): void {\n    // this is to prevent other cards from collapsing too\n\n    e.stopPropagation();\n\n    // dont update state if click was A link\n    if ((e.target as any).tagName === \"A\") {\n      return;\n    }\n\n    const target = e.target as any;\n\n    // allow some gutter expansion once shifted over\n    const gutterRatio = this.state.expandSelf ? 0.85 : 0.9;\n\n    if (\n      this.props.depth > 0 &&\n      this.props.canExpand &&\n      (e.pageX + target.offsetLeft) / window.innerWidth > gutterRatio\n    ) {\n      this.setState({ expandSelf: !this.state.expandSelf });\n    } else {\n      const isOpen = !this.props.isOpen;\n\n      if (this.props.comment === null) {\n        return;\n      }\n\n      this.props.onUpdateOpen(this.props.comment.id, isOpen, undefined);\n    }\n  }\n}\n\nexport function isValidComment(comment: KidsObj3 | null) {\n  if (comment === null) {\n    return false;\n  }\n  const isBad =\n    comment.deleted &&\n    (comment.kidsObj === undefined || comment.kidsObj!.length === 0);\n\n  return !isBad;\n}\n","import { H2, H4 } from '@blueprintjs/core';\nimport { History } from 'history';\nimport _ from 'lodash';\nimport React from 'react';\n\nimport { getDomain } from './getDomain';\nimport { isValidComment } from './HnComment';\nimport { HnCommentList } from './HnCommentList';\nimport { timeSince } from './timeSince';\n\ninterface HnStoryPageState {\n  collapsedComments: number[];\n  idToScrollTo: number | undefined;\n}\n\nexport interface HnStoryPageProps {\n  data: HnItem | undefined;\n\n  id: number | undefined;\n  history: History;\n\n  onVisitMarker(id: number): void;\n}\n\nexport const SESSION_COLLAPSED = \"SESSION_COLLAPSED\";\nexport class HnStoryPage extends React.Component<\n  HnStoryPageProps,\n  HnStoryPageState\n> {\n  constructor(props: HnStoryPageProps) {\n    super(props);\n\n    this.state = {\n      collapsedComments: [],\n      idToScrollTo: undefined,\n    };\n\n    this.anchorClickHandler = this.anchorClickHandler.bind(this);\n  }\n\n  render() {\n    if (this.props.data === undefined) {\n      return null;\n    }\n\n    console.log(\"scroll to ID\", this.state.idToScrollTo);\n\n    const storyData = this.props.data;\n\n    const storyLinkEl =\n      storyData.url === undefined ? (\n        <span>{storyData.title}</span>\n      ) : (\n        <a href={storyData.url}>{storyData.title}</a>\n      );\n\n    const comments = (storyData.kidsObj || []).filter(isValidComment);\n\n    document.title = `HN: ${storyData.title}`;\n\n    return (\n      <div>\n        <H2 style={{ overflowWrap: \"break-word\" }}>{storyLinkEl}</H2>\n        <H4>\n          <span>{storyData.by}</span>\n          <span>{\" | \"}</span>\n          <span>\n            {storyData.score}\n            {\" points\"}\n          </span>\n          <span>{\" | \"}</span>\n          <span>{timeSince(storyData.time)} ago</span>\n          <span>{\" | \"}</span>\n          <span>{getDomain(storyData.url)}</span>\n        </H4>\n        {storyData.text !== undefined && (\n          <p\n            className=\"top-text\"\n            dangerouslySetInnerHTML={{ __html: storyData.text }}\n          />\n        )}\n\n        <HnCommentList\n          childComments={comments}\n          canExpand={true}\n          depth={0}\n          collapsedIds={this.state.collapsedComments}\n          onUpdateOpen={(id, newOpen, scrollId) =>\n            this.handleCollapseEvent(id, newOpen, scrollId)\n          }\n          idToScrollTo={this.state.idToScrollTo}\n        />\n      </div>\n    );\n  }\n  handleCollapseEvent(\n    id: number,\n    newOpen: boolean,\n    scrollId: number | undefined\n  ): void {\n    // save the id to session storage\n\n    if (newOpen) {\n      // remove from list\n      const newIds = _.cloneDeep(this.state.collapsedComments);\n      _.remove(newIds, (c) => c === id);\n\n      sessionStorage.setItem(SESSION_COLLAPSED, JSON.stringify(newIds));\n      this.setState({ collapsedComments: newIds });\n    } else {\n      const newIds = this.state.collapsedComments.concat(id);\n\n      sessionStorage.setItem(SESSION_COLLAPSED, JSON.stringify(newIds));\n      this.setState({ collapsedComments: newIds });\n    }\n\n    if (scrollId !== undefined) {\n      this.setState({ idToScrollTo: scrollId });\n    }\n  }\n\n  componentDidMount() {\n    window.scrollTo({ top: 0 });\n\n    // set the data initially -- kick off async request if needed\n\n    document.body.addEventListener(\"click\", this.anchorClickHandler);\n\n    const strCollapsedIds = sessionStorage.getItem(SESSION_COLLAPSED);\n    // load the collapsed comments from session storage\n\n    if (strCollapsedIds !== null) {\n      const collapsedIds = JSON.parse(strCollapsedIds) as number[];\n\n      this.setState({ collapsedComments: collapsedIds });\n    }\n\n    // save the read stories to localForage\n\n    if (this.props.id !== undefined) {\n      this.props.onVisitMarker(this.props.id);\n    }\n  }\n\n  componentWillUnmount() {\n    document.body.removeEventListener(\"click\", this.anchorClickHandler);\n  }\n  anchorClickHandler(e: any) {\n    if (e.target.tagName !== \"A\") {\n      return;\n    }\n\n    // have a link\n\n    const link = e.target as HTMLAnchorElement;\n\n    const regex = /https?:\\/\\/news\\.ycombinator\\.com\\/item\\?id=(\\d+)/;\n    const matches = link.href.match(regex);\n\n    if (matches === null) {\n      link.target = \"_blank\";\n      return;\n    }\n\n    // this will navigate to the new page\n    this.props.history.push(\"/story/\" + matches[1]);\n\n    e.preventDefault();\n    return false;\n  }\n}\n","import \"./App.css\";\n\nimport React from \"react\";\nimport { RouteComponentProps, withRouter } from \"react-router\";\nimport { Subscribe } from \"unstated\";\n\nimport { GLOBAL_DATA_LAYER } from \".\";\nimport { DataLayer } from \"./DataLayer\";\nimport { Header } from \"./Header\";\nimport { HnStoryList } from \"./HnStoryList\";\nimport { HnStoryPage } from \"./HnStoryPage\";\n\ninterface AppPageProps\n  extends RouteComponentProps<{ page?: string; storyId?: string }> {}\n\nenum HnPage {\n  STORY_LIST,\n  STORY,\n}\n\nexport enum HnListSource {\n  Front,\n  Day,\n  Week,\n  Month,\n}\n\nexport type TrueHash = {\n  [key: number]: true;\n};\n\ninterface AppState {\n  activeList: HnListSource;\n  activePage: HnPage;\n  activeStoryId: number | undefined;\n\n  storyKey: number;\n}\n\nclass _App extends React.Component<AppPageProps, AppState> {\n  constructor(props: AppPageProps) {\n    super(props);\n\n    this.state = {\n      activeList: HnListSource.Front,\n      storyKey: 0,\n      activePage: HnPage.STORY_LIST,\n      activeStoryId: undefined,\n    };\n  }\n  static getDerivedStateFromProps(props: AppPageProps, state: AppState) {\n    let listType: HnListSource;\n    let hnPage: HnPage;\n    let storyId: number | undefined = undefined;\n\n    console.log(\"props page\", props.match.params.page);\n\n    const page =\n      props.match.params.storyId === undefined\n        ? props.match.params.page\n        : \"story\";\n\n    console.log(props.match, page);\n    switch (page) {\n      case \"day\":\n        listType = HnListSource.Day;\n        hnPage = HnPage.STORY_LIST;\n        break;\n\n      case \"week\":\n        listType = HnListSource.Week;\n        hnPage = HnPage.STORY_LIST;\n        break;\n\n      case \"month\":\n        listType = HnListSource.Month;\n        hnPage = HnPage.STORY_LIST;\n        break;\n\n      case \"story\":\n        hnPage = HnPage.STORY;\n        storyId = +(props.match.params.storyId ?? \"\");\n        listType = state.activeList;\n        break;\n\n      default:\n        listType = HnListSource.Front;\n        hnPage = HnPage.STORY_LIST;\n        break;\n    }\n\n    console.log(\"derived state\", props.match.params, listType, hnPage, storyId);\n\n    return {\n      activeList: listType,\n      activePage: hnPage,\n      activeStoryId: storyId,\n    };\n  }\n\n  async componentDidMount() {\n    // ensure that list and story are correct on a direct load\n    switch (this.state.activePage) {\n      case HnPage.STORY:\n        GLOBAL_DATA_LAYER.updateActiveStory(this.state.activeStoryId);\n        break;\n\n      case HnPage.STORY_LIST:\n        GLOBAL_DATA_LAYER.updateActiveList(this.state.activeList);\n        break;\n    }\n  }\n\n  async componentDidUpdate(prevProps: AppPageProps, prevState: AppState) {\n    const didPageChange = prevState.activeList !== this.state.activeList;\n\n    if (didPageChange) {\n      // load the correct items from the data layer\n      GLOBAL_DATA_LAYER.updateActiveList(this.state.activeList);\n    }\n\n    const didStoryIdChange =\n      prevState.activeStoryId !== this.state.activeStoryId;\n\n    if (didStoryIdChange) {\n      GLOBAL_DATA_LAYER.updateActiveStory(this.state.activeStoryId);\n    }\n  }\n\n  render() {\n    return (\n      <Subscribe to={[DataLayer]}>\n        {(dataLayer: DataLayer) => (\n          <div>\n            <Header\n              requestNewData={() => this.requestFreshDataFromDataLayer()}\n              isLoading={dataLayer.state.isLoadingNewData}\n            />\n            {this.state.activePage === HnPage.STORY && (\n              <HnStoryPage\n                id={this.state.activeStoryId}\n                history={this.props.history}\n                key={this.state.activeStoryId + \"-\" + this.state.storyKey}\n                onVisitMarker={(id) => dataLayer.saveIdToReadList(id)}\n                data={dataLayer.state.activeStory}\n              />\n            )}\n            {this.state.activePage === HnPage.STORY_LIST && (\n              <HnStoryList\n                items={dataLayer.state.activeList}\n                readIds={dataLayer.state.readItems}\n                history={this.props.history}\n              />\n            )}\n          </div>\n        )}\n      </Subscribe>\n    );\n  }\n  requestFreshDataFromDataLayer(): void {\n    switch (this.state.activePage) {\n      case HnPage.STORY:\n        if (this.state.activeStoryId !== undefined) {\n          console.log(\"reloading active story\");\n          GLOBAL_DATA_LAYER.reloadStoryById(this.state.activeStoryId);\n        }\n        break;\n      case HnPage.STORY_LIST:\n        console.log(\"reloading active list\");\n        GLOBAL_DATA_LAYER.reloadStoryListFromServer(this.state.activeList);\n        break;\n    }\n  }\n}\n\nexport const App = withRouter(_App);\n","import localforage from \"localforage\";\nimport _ from \"lodash\";\nimport { Container } from \"unstated\";\n\nimport { HnListSource, TrueHash } from \"./App\";\nimport { SESSION_COLLAPSED } from \"./HnStoryPage\";\n\ninterface DataLayerState {\n  allItems: HnItem[];\n  currentLists: DataList[];\n\n  activeListType: HnListSource | undefined;\n  activeStoryId: number | undefined;\n\n  activeList: HnItem[];\n  activeStory: HnItem | undefined;\n\n  isLoadingFresh: boolean;\n  isLoadingNewData: boolean;\n  isLoadingLocalStorage: boolean;\n  localStoragePromise: Promise<any> | undefined;\n\n  readItems: TrueHash;\n}\n\nexport interface DataList {\n  key: HnListSource;\n  stories: number[]; // will be an array of IDs\n}\n\nconst LOCAL_ALL_ITEMS = \"HN-ALL-ITEMS\";\nconst LOCAL_DATA_LISTS = \"HN-DATA-LISTS\";\nconst LOCAL_READ_ITEMS = \"STORAGE_READ_ITEMS\";\nexport class DataLayer extends Container<DataLayerState> {\n  constructor() {\n    super();\n\n    // run through some initial stuff?\n\n    this.initializeFromLocalStorage();\n    // load from local storage on creation\n\n    this.state = {\n      allItems: [],\n      currentLists: [],\n      isLoadingFresh: false,\n      isLoadingNewData: false,\n      activeList: [],\n      activeStory: undefined,\n      isLoadingLocalStorage: true,\n      localStoragePromise: undefined,\n      readItems: {},\n      activeListType: undefined,\n      activeStoryId: undefined,\n    };\n  }\n\n  async initializeFromLocalStorage() {\n    console.log(\"loading from local storage\");\n    this.setState({ isLoadingLocalStorage: true });\n\n    const allItemsProm = localforage.getItem<HnItem[]>(LOCAL_ALL_ITEMS);\n    const currentListsProm = localforage.getItem<DataList[]>(LOCAL_DATA_LISTS);\n    const readItemsProm = localforage.getItem<TrueHash>(LOCAL_READ_ITEMS);\n\n    const localStorageProm = Promise.all([\n      allItemsProm,\n      currentListsProm,\n      readItemsProm,\n    ]);\n\n    // add the promise so that others can await them too\n    this.setState({ localStoragePromise: localStorageProm });\n\n    const [allItems, currentLists, readItems] = await localStorageProm;\n\n    console.log(\"loaded from local storage\", allItems, currentLists);\n    const result = await this.setState({\n      allItems: allItems ?? [],\n      currentLists: currentLists ?? [],\n      isLoadingLocalStorage: false,\n      localStoragePromise: undefined,\n      readItems: readItems ?? {},\n    });\n\n    if (this.state.activeListType !== undefined) {\n      this.updateActiveList(this.state.activeListType);\n    }\n\n    if (this.state.activeStoryId !== undefined) {\n      this.updateActiveStory(this.state.activeStoryId);\n    }\n  }\n\n  saveIdToReadList(id: number): void {\n    const newReadList = _.cloneDeep(this.state.readItems);\n    console.log(\"new read list\", newReadList);\n\n    // skip out if already there\n    if (newReadList[id]) {\n      return;\n    }\n\n    newReadList[id] = true;\n\n    localforage.setItem(LOCAL_READ_ITEMS, newReadList);\n    this.setState({ readItems: newReadList });\n  }\n\n  async getStoryData(id: number) {\n    let item = this.state.allItems.find((c) => c.id === id);\n    if (item !== undefined) {\n      return item;\n    }\n\n    // hit the API for the story data\n    return await this.getStoryFromServer(id);\n  }\n\n  public async getStoryFromServer(id: number) {\n    let url = \"/api/story/\" + id;\n\n    this.updateIsLoadingStatus(true);\n    const response = await fetch(url);\n    if (!response.ok) {\n      console.error(response);\n      return undefined;\n    }\n    const data: HnItem | { error: string } = await response.json();\n\n    if (\"error\" in data) {\n      console.error(data);\n      this.updateIsLoadingStatus(false);\n      return undefined;\n    }\n\n    console.log(\"hn item from server\", data);\n\n    this.updateIsLoadingStatus(false);\n\n    // ensure new story is saved locally\n    const newItems = this.state.allItems.concat(data);\n    this.setState({ allItems: newItems });\n    return data;\n  }\n  updateIsLoadingStatus(isLoading: boolean) {\n    this.setState({ isLoadingNewData: isLoading });\n  }\n\n  async reloadStoryById(id: number) {\n    this.clearItemData(id);\n\n    const newStory = await this.getStoryData(id);\n    this.setState({ activeStory: newStory });\n  }\n\n  clearItemData(id: number) {\n    const itemRemoved = this.state.allItems.find((c) => c.id === id);\n\n    const newData = this.state.allItems.filter((c) => c.id !== id);\n    console.log(\"clear item\", {\n      before: this.state.allItems.length,\n      after: newData.length,\n    });\n\n    // need to clear any collpased ids also\n    if (itemRemoved !== undefined) {\n      // get all child ids\n\n      const itemsToCheck: (HnItem | KidsObj3)[] = [itemRemoved];\n\n      const strIds = sessionStorage.getItem(SESSION_COLLAPSED);\n\n      if (strIds !== null) {\n        const collapsedIds = JSON.parse(strIds) as number[];\n\n        const collapseHash = new Set(collapsedIds);\n\n        while (itemsToCheck.length) {\n          const item = itemsToCheck.shift();\n\n          if (item === undefined) {\n            continue;\n          }\n\n          // remove if collapsed\n          if (collapseHash.has(item.id)) {\n            collapseHash.delete(item.id);\n          }\n\n          item.kidsObj\n            ?.filter((c) => c !== null)\n            .forEach((c) => itemsToCheck.push(c!));\n        }\n\n        const newCollapse = Array.from(collapseHash);\n\n        console.log(\"old collapse\", collapsedIds, newCollapse);\n\n        sessionStorage.setItem(SESSION_COLLAPSED, JSON.stringify(newCollapse));\n      }\n    }\n\n    this.setState({ allItems: newData });\n  }\n\n  async updateActiveList(source: HnListSource) {\n    // TODO: add loading step if data is missing -- figure out how to trigger refresh\n\n    this.setState({ activeListType: source });\n\n    console.log(\"getpagedata\", source, this.state);\n\n    if (source === undefined) {\n      console.error(\"unknown page -> source map\");\n      return [];\n    }\n\n    if (this.state.isLoadingLocalStorage) {\n      console.log(\"need to wait for local storage first\");\n      return [];\n    }\n\n    if (this.state.localStoragePromise) {\n      console.log(\"waiting on local storage to load\");\n      await this.state.localStoragePromise;\n      console.log(\"local storage loaded\");\n    }\n\n    const idsToLoad = this.state.currentLists.find((c) => c.key === source);\n\n    if (idsToLoad === undefined) {\n      console.log(\"no ids to load...\");\n      this.reloadStoryListFromServer(source);\n      return;\n    }\n\n    let dataOut = idsToLoad.stories\n      .map((id) => this.state.allItems.find((c) => c.id === id))\n      .filter((c) => c !== undefined) as HnItem[];\n\n    if (source !== HnListSource.Front) {\n      dataOut = _.sortBy(dataOut, (c) => -c.score);\n    }\n\n    this.setState({ activeList: dataOut });\n  }\n\n  public async reloadStoryListFromServer(activeList: HnListSource) {\n    console.log(\"loading data\");\n    let url = \"\";\n    switch (activeList) {\n      case HnListSource.Front:\n        url = \"/topstories/topstories\";\n        break;\n      case HnListSource.Day:\n        url = \"/topstories/day\";\n        break;\n      case HnListSource.Week:\n        url = \"/topstories/week\";\n        break;\n      case HnListSource.Month:\n        url = \"/topstories/month\";\n        break;\n    }\n\n    if (this.state.isLoadingNewData) {\n      console.log(\"only have one request at a time\");\n      return;\n    }\n\n    this.updateIsLoadingStatus(true);\n\n    const response = await fetch(url);\n    if (!response.ok) {\n      console.error(response);\n      this.updateIsLoadingStatus(false);\n\n      return;\n    }\n    let data: HnItem[] = await response.json();\n\n    if (activeList !== HnListSource.Front) {\n      // flip score to get descending\n      data = _.sortBy<HnItem>(data, (c) => -c.score);\n    }\n\n    // TODO: take that list of items and set it equal to the current list\n    // TODO: update the items with a merge of sorts instead of overwriting\n\n    console.log(\"hn items from server\", data);\n\n    this.updateIsLoadingStatus(false);\n\n    this.updateNewItems(data, activeList);\n  }\n\n  updateNewItems(data: HnItem[] | undefined, listType: HnListSource): void {\n    console.log(\"items coming from server\", data, listType, this.state);\n\n    if (data === undefined) {\n      data = [];\n    }\n\n    // replace the list with the new IDs\n    const newList = data.map((c) => c.id);\n\n    const newDataList = _.cloneDeep(this.state.currentLists);\n\n    let listToUpdate = newDataList.find((c) => c.key === listType);\n\n    if (listToUpdate === undefined) {\n      newDataList.push({\n        key: listType,\n        stories: newList,\n      });\n    } else {\n      listToUpdate.stories = newList;\n    }\n\n    // get all items... replace those whose data is newer in this version\n\n    const newAllItems = _.cloneDeep(this.state.allItems);\n\n    const storiesToReturn: HnItem[] = [];\n\n    data.forEach((newStory) => {\n      const existingStoryIndex = newAllItems.findIndex(\n        (c) => c.id === newStory.id\n      );\n\n      // add the story if it is new\n      if (existingStoryIndex === -1) {\n        newAllItems.push(newStory);\n        storiesToReturn.push(newStory);\n        return;\n      }\n\n      // check the data if already found\n      const existingStory = newAllItems[existingStoryIndex];\n      if (existingStory.lastUpdated > newStory.lastUpdated) {\n        storiesToReturn.push(existingStory);\n        return;\n      }\n\n      newAllItems[existingStoryIndex] = newStory;\n      storiesToReturn.push(newStory);\n\n      // new story is actually newer... replace its data\n    });\n\n    // update otherwise\n\n    this.saveNewDataToLocalStorage(newAllItems, newDataList);\n\n    this.setState({\n      allItems: newAllItems,\n      currentLists: newDataList,\n      activeList: data,\n    });\n  }\n  saveNewDataToLocalStorage(newAllItems: HnItem[], newDataList: DataList[]) {\n    localforage.setItem(LOCAL_ALL_ITEMS, newAllItems);\n    localforage.setItem(LOCAL_DATA_LISTS, newDataList);\n  }\n\n  async updateActiveStory(activeStoryId: number | undefined) {\n    this.setState({ activeStoryId: activeStoryId });\n\n    if (activeStoryId === undefined) {\n      this.setState({ activeStory: undefined });\n      return;\n    }\n\n    if (this.state.isLoadingLocalStorage) {\n      console.log(\"will update story when local storage is ready\");\n      return;\n    }\n\n    const story = await this.getStoryData(activeStoryId);\n\n    this.setState({ activeStory: story });\n  }\n}\n","import { Button, Navbar, Spinner } from \"@blueprintjs/core\";\nimport React from \"react\";\nimport { Link, NavLink } from \"react-router-dom\";\n\ninterface HeaderProps {\n  requestNewData(): void;\n  isLoading: boolean;\n}\n\nexport class Header extends React.PureComponent<HeaderProps> {\n  render() {\n    return (\n      <Navbar style={{ marginBottom: 10 }}>\n        <Navbar.Group>\n          <Link to=\"/\" className=\"bp3-button bp3-minimal  header-link\">\n            <Navbar.Heading style={{ display: \"flex\", alignItems: \"center\" }}>\n              <img src=\"favicon-32x32.png\" />\n              <span style={{ marginLeft: 3, color: \"#5C7080\" }}>offline</span>\n            </Navbar.Heading>\n          </Link>\n\n          <NavLink\n            to=\"/day\"\n            className=\"bp3-button bp3-minimal  header-link\"\n            activeClassName=\"bp3-active bp3-intent-primary\"\n          >\n            day\n          </NavLink>\n          <NavLink\n            to=\"/week\"\n            className=\"bp3-button bp3-minimal  header-link\"\n            activeClassName=\"bp3-active bp3-intent-primary\"\n          >\n            week\n          </NavLink>\n          <NavLink\n            to=\"/month\"\n            className=\"bp3-button bp3-minimal  header-link\"\n            activeClassName=\"bp3-active bp3-intent-primary\"\n          >\n            month\n          </NavLink>\n        </Navbar.Group>\n\n        <Navbar.Group align=\"right\">\n          {this.props.isLoading && <Spinner size={32} />}\n          {!this.props.isLoading && (\n            <Button\n              intent=\"primary\"\n              onClick={() => this.props.requestNewData()}\n              icon=\"refresh\"\n              minimal={true}\n            />\n          )}\n        </Navbar.Group>\n      </Navbar>\n    );\n  }\n}\n","import { Icon } from \"@blueprintjs/core\";\nimport classNames from \"classnames\";\nimport React from \"react\";\nimport { Link } from \"react-router-dom\";\n\nimport { getDomain } from \"./getDomain\";\nimport { timeSince } from \"./timeSince\";\n\nexport interface HnStoryProps {\n  data: HnItem;\n\n  isRead: boolean | undefined;\n}\n\nexport class HnListItem extends React.Component<HnStoryProps> {\n  render() {\n    const story = this.props.data;\n\n    const commentCount = (\n      <React.Fragment>\n        {\" | \"}\n        <Link to={\"/story/\" + story.id}>\n          <Icon icon=\"comment\" /> {story.descendants}\n        </Link>\n      </React.Fragment>\n    );\n\n    const storyLinkEl =\n      story.url === undefined ? (\n        <Link to={\"/story/\" + story.id}>{story.title}</Link>\n      ) : (\n        <a href={story.url} target=\"_blank\">\n          {story.title}\n        </a>\n      );\n\n    return (\n      <div className={classNames({ isRead: this.props.isRead })}>\n        <p>{storyLinkEl}</p>\n        <p>\n          <span>\n            <Icon icon=\"chevron-up\" /> {\" \" + story.score}\n          </span>\n          {story.descendants !== undefined && commentCount}\n          <span>{\" | \" + timeSince(story.time) + \" ago\"}</span>\n          <span>{\" | \" + getDomain(story.url)}</span>\n        </p>\n      </div>\n    );\n  }\n}\n","import { History } from \"history\";\nimport React from \"react\";\n\nimport { TrueHash } from \"./App\";\nimport { HnListItem } from \"./HnListItem\";\n\ninterface HnStoryListProps {\n  items: HnItem[];\n  readIds: TrueHash;\n  history: History;\n}\n\nconst SESSION_SCROLL = \"SCROLL_LIST\";\nexport class HnStoryList extends React.Component<HnStoryListProps> {\n  constructor(props: HnStoryListProps) {\n    super(props);\n    this.state = {\n      items: [],\n    };\n  }\n\n  componentDidMount() {\n    // TODO: get the types right for this\n    const history = this.props.history;\n    console.log(\"story list mount\", history);\n\n    if (history.action === \"POP\") {\n      // restore scroll pos if available\n      const scrollPos = +sessionStorage.getItem(SESSION_SCROLL)!;\n\n      if (!isNaN(scrollPos)) {\n        console.log(\"fire off scroll\", scrollPos);\n        window.scrollTo({ top: scrollPos });\n      }\n    }\n  }\n\n  componentWillUnmount() {\n    console.log(\"save scroll pos\", window.scrollY);\n\n    sessionStorage.setItem(SESSION_SCROLL, \"\" + window.scrollY);\n  }\n\n  render() {\n    document.title = `HN: Offline`;\n    return (\n      <div>\n        {this.props.items\n          .filter((story) => story.descendants !== undefined)\n          .map((item) => (\n            <HnListItem\n              data={item}\n              key={item.id}\n              isRead={this.props.readIds[item.id]}\n            />\n          ))}\n      </div>\n    );\n  }\n}\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read http://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      (process as { env: { [key: string]: string } }).env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit http://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See http://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import \"@blueprintjs/core/lib/css/blueprint.css\";\n\nimport localForage from \"localforage\";\nimport React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport { BrowserRouter, Route } from \"react-router-dom\";\nimport smoothscroll from \"smoothscroll-polyfill\";\n\nimport { App } from \"./App\";\nimport * as serviceWorker from \"./serviceWorker\";\n\nimport { Provider } from \"unstated\";\nimport { DataLayer } from \"./DataLayer\";\n\n// kick off the polyfill!\nsmoothscroll.polyfill();\n\nwindow.onerror = function (msg, url, lineNo, columnNo, error) {\n  // ... handle error ...\n  console.error(\"major error\", msg);\n  localForage.clear();\n\n  document.body.innerHTML =\n    \"<h1>major error occurred.  local storage cleared to avoid corruption. please refresh.</h1>\";\n};\n\n// check if version exists\nconst version = localStorage.getItem(\"VERSION\");\nif (version === null) {\n  localForage.clear();\n}\n\nlocalStorage.setItem(\"VERSION\", \"1.0\");\n\nexport const GLOBAL_DATA_LAYER = new DataLayer();\n\nReactDOM.render(\n  <BrowserRouter>\n    <Route path={[\"/story/:storyId\", \"/:page?\"]}>\n      <Provider inject={[GLOBAL_DATA_LAYER]}>\n        <App />\n      </Provider>\n    </Route>\n  </BrowserRouter>,\n  document.getElementById(\"root\")\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: http://bit.ly/CRA-PWA\nserviceWorker.register();\n"],"sourceRoot":""}