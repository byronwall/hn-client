(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{32:function(e,t,a){e.exports=a(47)},39:function(e,t,a){},47:function(e,t,a){"use strict";a.r(t);a(33);var n,r=a(0),s=a.n(r),i=a(26),o=a.n(i),c=a(55),u=a(53),l=a(30),m=a(5),d=a(7),p=a(6),h=a(3),v=a(8),f=a(15),b=(a(39),a(16)),k=a.n(b),y=a(51),I=a(25),O=a(52),E=a(20),g=a.n(E),w=a(27),j=a(21),D=a.n(j),S=function(e){function t(e){var a;return Object(m.a)(this,t),(a=Object(d.a)(this,Object(p.a)(t).call(this,e))).state={item:void 0},a}return Object(v.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){return null}},{key:"componentDidMount",value:function(){var e=this,t=localStorage.getItem(this.props.storageName);if(void 0!==t&&null!==t){var a=D.a.decompress(t);if(null===a)return localStorage.removeItem(this.props.storageName),void this.setState({item:void 0},function(){return e.props.dataDidUpdate(void 0)});var n=JSON.parse(a);this.setState({item:n},function(){return e.props.dataDidUpdate(n)})}else this.setState({item:void 0},function(){return e.props.dataDidUpdate(void 0)})}},{key:"componentDidUpdate",value:function(e,t){var a=this;if(!k.a.isEqual(e.activeItem,this.props.activeItem)){if(void 0===this.props.activeItem)return;if(k.a.isEqual(this.state.item,this.props.activeItem))return;console.log("save item",this.props.activeItem);var n=JSON.stringify(this.props.activeItem),r=D.a.compress(n);localStorage.setItem(this.props.storageName,r),this.setState({item:this.props.activeItem},function(){return a.props.dataDidUpdate(a.props.activeItem)})}}}]),t}(s.a.Component),N=function(e){function t(e){var a;return Object(m.a)(this,t),(a=Object(d.a)(this,Object(p.a)(t).call(this,e))).state={dayItems:[],frontItems:[],monthItems:[],weekItems:[]},a}return Object(v.a)(t,e),Object(h.a)(t,[{key:"refreshData",value:function(e){}}]),Object(h.a)(t,[{key:"render",value:function(){var e=this;return s.a.createElement(s.a.Fragment,null,s.a.createElement(S,{dataDidUpdate:function(t){return e.updateNewItems(t,n.Front)},activeItem:this.state.frontItems,storageName:"HN-ITEMS"}),s.a.createElement(S,{dataDidUpdate:function(t){return e.updateNewItems(t,n.Day)},activeItem:this.state.dayItems,storageName:"HN-DAY-ITEMS"}),s.a.createElement(S,{dataDidUpdate:function(t){return e.updateNewItems(t,n.Week)},activeItem:this.state.weekItems,storageName:"HN-WEEK-ITEMS"}),s.a.createElement(S,{dataDidUpdate:function(t){return e.updateNewItems(t,n.Month)},activeItem:this.state.monthItems,storageName:"HN-MONTH-ITEMS"}))}},{key:"getStoryData",value:function(e){var t=this.state.frontItems.find(function(t){return t.id===e});return void 0!==t?t:void 0!==(t=this.state.dayItems.find(function(t){return t.id===e}))?t:void 0!==(t=this.state.weekItems.find(function(t){return t.id===e}))?t:void 0!==(t=this.state.monthItems.find(function(t){return t.id===e}))?t:void 0}},{key:"getPageData",value:function(e){switch(console.log("getpage state",this.state),e){case"day":return 0===this.state.dayItems.length&&this.loadData(n.Day),this.state.dayItems||[];case"week":return 0===this.state.weekItems.length&&this.loadData(n.Week),this.state.weekItems||[];case"month":return 0===this.state.monthItems.length&&this.loadData(n.Month),this.state.monthItems||[];default:return 0===this.state.frontItems.length&&this.loadData(n.Front),this.state.frontItems||[]}}},{key:"loadData",value:function(){var e=Object(w.a)(g.a.mark(function e(t){var a,r,s;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:console.log("loading data"),a="",e.t0=t,e.next=e.t0===n.Front?5:e.t0===n.Day?7:e.t0===n.Week?9:e.t0===n.Month?11:13;break;case 5:return a="/topstories/topstories",e.abrupt("break",13);case 7:return a="/topstories/day",e.abrupt("break",13);case 9:return a="/topstories/week",e.abrupt("break",13);case 11:return a="/topstories/month",e.abrupt("break",13);case 13:return e.next=15,fetch(a);case 15:if((r=e.sent).ok){e.next=19;break}return console.error(r),e.abrupt("return");case 19:return e.next=21,r.json();case 21:s=e.sent,console.log("hn items",s),this.updateNewItems(s,t);case 24:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"updateNewItems",value:function(e,t){switch(console.log("new items2",e,t),void 0===e&&(e=[]),t){case n.Front:this.setState({frontItems:e});break;case n.Day:this.setState({dayItems:e});break;case n.Week:this.setState({weekItems:e});break;case n.Month:this.setState({monthItems:e})}this.props.provideNewItems(e,t)}}]),t}(s.a.Component),M=a(54),L=a(17),F=a(49),C=function(e){function t(){return Object(m.a)(this,t),Object(d.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(v.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){return s.a.createElement(M.a,null,s.a.createElement(M.a.Group,{align:L.a.LEFT},s.a.createElement(M.a.Heading,null,s.a.createElement(F.a,{to:"/"},"hn-offline")),s.a.createElement(M.a.Divider,null),s.a.createElement(F.a,{to:"/day"},"day"),s.a.createElement(M.a.Divider,null),s.a.createElement(F.a,{to:"/week"},"week"),s.a.createElement(M.a.Divider,null),s.a.createElement(F.a,{to:"/month"},"month")))}}]),t}(s.a.Component),W=function(e){function t(){return Object(m.a)(this,t),Object(d.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(v.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e=this.props.data;return s.a.createElement("div",null,s.a.createElement("p",null,s.a.createElement("a",{href:e.url},e.title)),s.a.createElement("p",null,s.a.createElement("span",null,e.score+" | "),s.a.createElement(F.a,{to:"/story/"+e.id},s.a.createElement("span",null,e.descendants)),s.a.createElement("span",null," | "+e.score)))}}]),t}(s.a.Component),U=function(e){function t(e){var a;return Object(m.a)(this,t),(a=Object(d.a)(this,Object(p.a)(t).call(this,e))).state={items:[]},a}return Object(v.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){return s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{onClick:this.props.requestNewData},"reload"),s.a.createElement("div",null,this.props.items.map(function(e){return s.a.createElement(W,{data:e,key:e.id})})))}}]),t}(s.a.Component),x=a(50),P=function(e){function t(e){var a;return Object(m.a)(this,t),(a=Object(d.a)(this,Object(p.a)(t).call(this,e))).state={isOpen:!0},a}return Object(v.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e=this,a=this.props.comment.kidsObj||[],n=this.props.comment.text||"",r=this.state.isOpen?s.a.createElement(s.a.Fragment,null,s.a.createElement("p",{dangerouslySetInnerHTML:{__html:n}}),a.map(function(a){return s.a.createElement(t,{key:e.props.comment.id+"-"+a.id,comment:a,depth:e.props.depth+1})})):null;return s.a.createElement(x.a,{interactive:!0,onClick:function(t){return e.handleCardClick(t)},style:{paddingLeft:10*this.props.depth,width:"100%"}},s.a.createElement("p",null,this.props.comment.by),r)}},{key:"handleCardClick",value:function(e){e.stopPropagation(),this.setState({isOpen:!this.state.isOpen})}}]),t}(s.a.Component),T=function(e){function t(){return Object(m.a)(this,t),Object(d.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(v.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){if(void 0===this.props.data)return null;var e=this.props.data.kidsObj||[];return s.a.createElement("div",null,s.a.createElement("h2",null,this.props.data.title),e.map(function(e){return s.a.createElement(P,{key:e.id,comment:e,depth:0})}))}},{key:"componentDidMount",value:function(){window.scrollTo(0,0)}}]),t}(s.a.Component),H=function(e){function t(e){var a;return Object(m.a)(this,t),(a=Object(d.a)(this,Object(p.a)(t).call(this,e))).state={items:[],allItems:[],activeList:n.Front},a.dataLayer=s.a.createRef(),a.updateActiveDataStore=a.updateActiveDataStore.bind(Object(f.a)(Object(f.a)(a))),a.newItemsProvided=a.newItemsProvided.bind(Object(f.a)(Object(f.a)(a))),a}return Object(v.a)(t,e),Object(h.a)(t,null,[{key:"getDerivedStateFromProps",value:function(e,t){var a;switch(e.match.params.page){case"day":a=n.Day;break;case"week":a=n.Week;break;case"month":a=n.Month;break;default:a=n.Front}return console.log("derived state",e.match.params.page,a),Object(l.a)({},t,{activeList:a})}}]),Object(h.a)(t,[{key:"updateActiveDataStore",value:function(e,t){t&&this.setState({items:e}),this.setState(function(t){var a=k.a.cloneDeep(t.allItems).concat(e);return a=k.a.uniqBy(a,function(e){return e.id}),console.log("new all itemS",a),{allItems:a}})}},{key:"render",value:function(){var e=this;return console.log("render state",this.state),s.a.createElement("div",null,s.a.createElement(N,{ref:this.dataLayer,provideNewItems:this.newItemsProvided}),s.a.createElement(C,null),s.a.createElement(y.a,null,s.a.createElement(I.a,{path:"/story/:id",exact:!0,render:function(t){return s.a.createElement(T,{data:null===e.dataLayer.current?void 0:e.dataLayer.current.getStoryData(+t.match.params.id)})}}),s.a.createElement(I.a,{path:"/:page?",render:function(t){return s.a.createElement(U,{items:null===e.dataLayer.current?[]:e.dataLayer.current.getPageData(t.match.params.page),requestNewData:function(){e.dataLayer.current.updateNewItems(void 0,e.state.activeList),e.setState({items:[]})}})}})))}},{key:"newItemsProvided",value:function(e,t){t===this.state.activeList&&this.setState({items:e})}}]),t}(s.a.Component),q=Object(O.a)(H);!function(e){e[e.Front=0]="Front",e[e.Day=1]="Day",e[e.Week=2]="Week",e[e.Month=3]="Month"}(n||(n={}));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(s.a.createElement(c.a,null,s.a.createElement(u.a,{path:"/:page?"},s.a.createElement(q,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[32,2,1]]]);
//# sourceMappingURL=main.8e6fc65b.chunk.js.map