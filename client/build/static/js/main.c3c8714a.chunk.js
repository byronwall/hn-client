(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{156:function(e,t,a){"use strict";a.r(t);a(87),a(89),a(91);var n=a(28),r=a.n(n),o=a(0),i=a.n(o),s=a(33),c=a.n(s),l=a(44),u=a(40),d=a(74),p=a.n(d),h=a(82),f=a(10),m=a(12),v=a(11),b=a(8),g=a(13),y=a(20),k=(a(97),a(21)),E=a.n(k),O=a(106),w=a(51),j=a(107),L=a(18),S=a.n(L),D=a(24),x=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(m.a)(this,Object(v.a)(t).call(this,e))).state={item:void 0},a}return Object(g.a)(t,e),Object(b.a)(t,[{key:"render",value:function(){return null}},{key:"componentDidMount",value:function(){var e=Object(D.a)(S.a.mark(function e(){var t,a,n=this;return S.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.a.getItem(this.props.storageName);case 2:if(void 0!==(t=e.sent)&&null!==t){e.next=6;break}return this.setState({item:void 0},function(){return n.props.dataDidUpdate(void 0)}),e.abrupt("return");case 6:if(null!==t){e.next=10;break}return r.a.removeItem(this.props.storageName),this.setState({item:void 0},function(){return n.props.dataDidUpdate(void 0)}),e.abrupt("return");case 10:a=JSON.parse(t),this.setState({item:a},function(){return n.props.dataDidUpdate(a)});case 12:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"componentDidUpdate",value:function(e,t){var a=this;if(!E.a.isEqual(e.activeItem,this.props.activeItem)){if(void 0===this.props.activeItem)return;if(E.a.isEqual(this.state.item,this.props.activeItem))return;console.log("save item",this.props.activeItem);var n=JSON.stringify(this.props.activeItem);r.a.setItem(this.props.storageName,n),this.setState({item:this.props.activeItem},function(){console.log("updating data after a save?"),a.props.dataDidUpdate(a.props.activeItem)})}}}]),t}(i.a.Component),I=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(m.a)(this,Object(v.a)(t).call(this,e))).state={allItems:[],currentLists:[],isLoadingFresh:!1,isLoadingNewData:!1},a}return Object(g.a)(t,e),Object(b.a)(t,[{key:"refreshData",value:function(e){}}]),Object(b.a)(t,[{key:"render",value:function(){var e=this;return i.a.createElement(i.a.Fragment,null,i.a.createElement(x,{dataDidUpdate:function(t){return e.processDataFromLocalStorage(t,e.state.currentLists)},activeItem:this.state.allItems,storageName:"HN-ALL-ITEMS"}),i.a.createElement(x,{dataDidUpdate:function(t){return e.processDataFromLocalStorage(e.state.allItems,t)},activeItem:this.state.currentLists,storageName:"HN-DATA-LISTS"}))}},{key:"getStoryData",value:function(){var e=Object(D.a)(S.a.mark(function e(t){var a;return S.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===(a=this.state.allItems.find(function(e){return e.id===t}))){e.next=3;break}return e.abrupt("return",a);case 3:return e.next=5,this.getStoryFromServer(t);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getStoryFromServer",value:function(){var e=Object(D.a)(S.a.mark(function e(t){var a,n,r;return S.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a="/api/story/"+t,this.props.updateIsLoadingStatus(!0),e.next=4,fetch(a);case 4:if((n=e.sent).ok){e.next=8;break}return console.error(n),e.abrupt("return",void 0);case 8:return e.next=10,n.json();case 10:if(!("error"in(r=e.sent))){e.next=15;break}return console.error(r),this.props.updateIsLoadingStatus(!1),e.abrupt("return",void 0);case 15:return console.log("hn item from server",r),this.props.updateIsLoadingStatus(!1),e.abrupt("return",r);case 18:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getPageData",value:function(e){var t=this;console.log("getpagedata",e,this.state),""!==e&&void 0!==e||(e="front");var a={day:V.Day,week:V.Week,month:V.Month,front:V.Front}[e];if(void 0===a)return console.error("unknown page -> source map"),[];var n=this.state.currentLists.find(function(e){return e.key===a});return void 0===n?(console.log("no ids to load..."),this.loadData(a),[]):n.stories.map(function(e){return t.state.allItems.find(function(t){return t.id===e})}).filter(function(e){return void 0!==e})}},{key:"loadData",value:function(){var e=Object(D.a)(S.a.mark(function e(t){var a,n,r;return S.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:console.log("loading data"),a="",e.t0=t,e.next=e.t0===V.Front?5:e.t0===V.Day?7:e.t0===V.Week?9:e.t0===V.Month?11:13;break;case 5:return a="/topstories/topstories",e.abrupt("break",13);case 7:return a="/topstories/day",e.abrupt("break",13);case 9:return a="/topstories/week",e.abrupt("break",13);case 11:return a="/topstories/month",e.abrupt("break",13);case 13:if(!this.state.isLoadingNewData){e.next=16;break}return console.log("only have one request at a time"),e.abrupt("return");case 16:return this.props.updateIsLoadingStatus(!0),this.setState({isLoadingNewData:!0}),e.next=20,fetch(a);case 20:if((n=e.sent).ok){e.next=26;break}return console.error(n),this.props.updateIsLoadingStatus(!1),this.setState({isLoadingNewData:!1}),e.abrupt("return");case 26:return e.next=28,n.json();case 28:r=e.sent,t!==V.Front&&(r=E.a.sortBy(r,function(e){return-e.score})),console.log("hn items from server",r),this.props.updateIsLoadingStatus(!1),this.setState({isLoadingNewData:!1}),this.updateNewItems(r,t);case 34:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"processDataFromLocalStorage",value:function(e,t){var a=this;console.log("fresh data from local storage",e,t),void 0!==e&&this.setState({allItems:e}),void 0!==t&&this.setState({currentLists:t}),void 0!==e&&void 0!==t?t.forEach(function(t){var n=t.stories.map(function(t){return e.find(function(e){return e.id===t})}).filter(function(e){return void 0!==e});a.props.provideNewItems(n,t.key)}):this.state.isLoadingFresh||(console.log("local storage is empty, loading fresh data based on active page",this.props.loadFreshSource),this.setState({isLoadingFresh:!0}),this.loadData(this.props.loadFreshSource))}},{key:"updateNewItems",value:function(e,t){var a=this;console.log("items coming from server",e,t),void 0===e&&(e=[]);var n=e.map(function(e){return e.id}),r=E.a.cloneDeep(this.state.currentLists),o=r.find(function(e){return e.key===t});void 0===o?r.push({key:t,stories:n}):o.stories=n;var i=E.a.cloneDeep(this.state.allItems),s=[];e.forEach(function(e){var t=i.findIndex(function(t){return t.id===e.id});if(-1===t)return i.push(e),void s.push(e);var a=i[t];a.lastUpdated>e.lastUpdated?s.push(a):(i[t]=e,s.push(e))}),this.setState({allItems:i,currentLists:r},function(){a.props.provideNewItems(s,t)})}}]),t}(i.a.Component),C=a(162),N=a(164),F=a(159),M=a(160),R=a(161),W=a(46),T=a(50),U=a(163),A=function(e){function t(){return Object(f.a)(this,t),Object(m.a)(this,Object(v.a)(t).apply(this,arguments))}return Object(g.a)(t,e),Object(b.a)(t,[{key:"render",value:function(){var e=this;return i.a.createElement(C.a,null,i.a.createElement(C.a.Header,null,i.a.createElement(C.a.Brand,null,i.a.createElement(T.a,{to:"/"},"hn-offline"))),i.a.createElement(N.a,null,i.a.createElement(W.LinkContainer,{to:"/day"},i.a.createElement(F.a,{eventKey:1},"day")),i.a.createElement(W.LinkContainer,{to:"/week"},i.a.createElement(F.a,{eventKey:2},"week")),i.a.createElement(W.LinkContainer,{to:"/month"},i.a.createElement(F.a,{eventKey:3},"month"))),i.a.createElement(C.a.Form,{pullRight:!0},this.props.isLoading&&i.a.createElement(U.a,{size:32}),!this.props.isLoading&&i.a.createElement(u.a,{render:function(t){return-1===t.location.pathname.indexOf("/story")?i.a.createElement(M.a,{bsStyle:"primary",onClick:function(){return e.props.requestNewData()}},i.a.createElement(R.a,{glyph:"refresh"})):null}})))}}]),t}(i.a.PureComponent),H=a(39);function P(e){if(void 0===e)return"";var t=e.match(/^https?\:\/\/([^\/?#]+)(?:[\/?#]|$)/i);return t&&t[1]}function q(e){var t=Math.floor((new Date).getTime()/1e3-e),a=Math.floor(t/31536e3);return a>1?a+" years":(a=Math.floor(t/2592e3))>1?a+" months":(a=Math.floor(t/86400))>1?a+" days":(a=Math.floor(t/3600))>=1?a+" hour"+(a>1?"s":""):(a=Math.floor(t/60))>1?a+" minutes":Math.floor(t)+" seconds"}var _=function(e){function t(){return Object(f.a)(this,t),Object(m.a)(this,Object(v.a)(t).apply(this,arguments))}return Object(g.a)(t,e),Object(b.a)(t,[{key:"render",value:function(){var e=this.props.data,t=i.a.createElement(i.a.Fragment,null," | ",i.a.createElement(H.a,{to:"/story/"+e.id},i.a.createElement(R.a,{glyph:"comment"})," ",e.descendants)),a=void 0===e.url?i.a.createElement(H.a,{to:"/story/"+e.id},e.title):i.a.createElement("a",{href:e.url,target:"_blank"},e.title);return i.a.createElement("div",null,i.a.createElement("p",null,a),i.a.createElement("p",null,i.a.createElement("span",null,i.a.createElement(R.a,{glyph:"chevron-up"})," "," "+e.score),void 0!==e.descendants&&t,i.a.createElement("span",null," | "+q(e.time)+" ago"),i.a.createElement("span",null," | "+P(e.url))))}}]),t}(i.a.Component),B=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(m.a)(this,Object(v.a)(t).call(this,e))).state={items:[]},a}return Object(g.a)(t,e),Object(b.a)(t,[{key:"render",value:function(){return document.title="HN: Offline",i.a.createElement("div",null,this.props.items.filter(function(e){return void 0!==e.descendants}).map(function(e){return i.a.createElement(_,{data:e,key:e.id})}))}}]),t}(i.a.Component),J=a(4),K=a.n(J),$=a(60),z=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(m.a)(this,Object(v.a)(t).call(this,e))).childRefs=[],e.childComments.forEach(function(e){null!==e&&(a.childRefs[e.id]=i.a.createRef())}),a}return Object(g.a)(t,e),Object(b.a)(t,[{key:"render",value:function(){var e=this,t=this.props.childComments.filter(function(e){return null!==e});return i.a.createElement(i.a.Fragment,null,t.map(function(a,n){return i.a.createElement(G,{key:a.id,comment:a,depth:e.props.depth,canExpand:e.props.canExpand,ref:e.childRefs[a.id],scrollToNextChild:function(){var a=t[n+1],r=t[n];if(null!==r){void 0!==a&&null!==a||(a=r);var o=e.childRefs[a.id].current.getDivRef(),i=Object($.a)(o,{block:"nearest",inline:"nearest",scrollMode:"if-needed"}),s=e.childRefs[r.id].current.getDivRef(),c=Object($.a)(s,{block:"nearest",inline:"nearest",scrollMode:"if-needed"});0==i.length&&0==c.length||window.scrollTo({top:o.offsetTop-80,behavior:"smooth"})}}})}))}}]),t}(i.a.Component),X=["#bc8672","#c5be53","#d46850","#8c7f3b","#dec392","#c9893a"],G=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(m.a)(this,Object(v.a)(t).call(this,e))).state={isOpen:!0,expandSelf:!1},a.divRef=i.a.createRef(),a}return Object(g.a)(t,e),Object(b.a)(t,null,[{key:"getDerivedStateFromProps",value:function(e,t){return e.canExpand?null:{isOpen:t.isOpen,expandSelf:!1}}}]),Object(b.a)(t,[{key:"getDivRef",value:function(){return this.divRef.current}},{key:"render",value:function(){var e=this,t=this.props.comment;if(null===t)return null;var a=(t.kidsObj||[]).filter(Q),n=t.text||"";if(!Q(t))return null;var r=this.state.isOpen?i.a.createElement(i.a.Fragment,null,i.a.createElement("p",{className:"comment",dangerouslySetInnerHTML:{__html:n}}),a.length>0&&i.a.createElement(z,{childComments:a,canExpand:this.props.canExpand&&!this.state.expandSelf,depth:this.props.depth+1})):null,o=this.props.depth<X.length?X[this.props.depth]:"#bbb";return i.a.createElement("div",{className:K()("bp3-card",{collapsed:!this.state.isOpen}),onClick:function(t){return e.handleCardClick(t)},style:{paddingLeft:12+Math.max(4-this.props.depth),marginLeft:this.state.expandSelf&&this.state.isOpen?-17*this.props.depth:0,borderLeftColor:o,borderLeftWidth:this.state.expandSelf?6:void 0,borderRight:this.state.expandSelf?"1px solid"+o:void 0,paddingRight:this.state.expandSelf?6:void 0}},i.a.createElement("p",{style:{fontWeight:this.state.isOpen?450:300},ref:this.divRef},t.by," | ",q(t.time)," ago"),r)}},{key:"handleCardClick",value:function(e){var t=this;if(e.stopPropagation(),"A"!==e.target.tagName){var a=e.target,n=this.state.expandSelf?.85:.9;if(this.props.depth>0&&this.props.canExpand&&(e.pageX+a.offsetLeft)/window.innerWidth>n)this.setState({expandSelf:!this.state.expandSelf});else{var r=!this.state.isOpen;this.setState({isOpen:r},function(){r||t.props.scrollToNextChild()})}}}}]),t}(i.a.Component);function Q(e){return null!==e&&!(e.deleted&&(void 0===e.kidsObj||0===e.kidsObj.length))}var V,Y=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(m.a)(this,Object(v.a)(t).call(this,e))).state={data:void 0},a.anchorClickHandler=a.anchorClickHandler.bind(Object(y.a)(Object(y.a)(a))),a}return Object(g.a)(t,e),Object(b.a)(t,[{key:"render",value:function(){if(void 0===this.state.data)return null;var e=this.state.data,t=void 0===e.url?i.a.createElement("span",null,e.title):i.a.createElement("a",{href:e.url},e.title),a=(e.kidsObj||[]).filter(Q);return document.title="HN: ".concat(e.title),i.a.createElement("div",null,i.a.createElement("h2",{style:{overflowWrap:"break-word"}},t),i.a.createElement("h4",null,i.a.createElement("span",null,e.by),i.a.createElement("span",null," | "),i.a.createElement("span",null,e.score," points"),i.a.createElement("span",null," | "),i.a.createElement("span",null,q(e.time)," ago"),i.a.createElement("span",null," | "),i.a.createElement("span",null,P(e.url))),void 0!==e.text&&i.a.createElement("p",{className:"top-text",dangerouslySetInnerHTML:{__html:e.text}}),i.a.createElement(z,{childComments:a,canExpand:!0,depth:0}))}},{key:"componentDidMount",value:function(){window.scrollTo(0,0),this.updateDataFromDataLayer(),document.body.addEventListener("click",this.anchorClickHandler)}},{key:"componentWillUnmount",value:function(){document.body.removeEventListener("click",this.anchorClickHandler)}},{key:"anchorClickHandler",value:function(e){if("A"===e.target.tagName){var t=e.target,a=t.href.match(/https?:\/\/news\.ycombinator\.com\/item\?id=(\d+)/);if(null!==a)return this.props.history.push("/story/"+a[1]),e.preventDefault(),!1;t.target="_blank"}}},{key:"updateDataFromDataLayer",value:function(){var e=Object(D.a)(S.a.mark(function e(){var t;return S.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getStoryData(this.props.id);case 2:t=e.sent,this.setState({data:t});case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"componentDidUpdate",value:function(e){null===e.dataLayer&&null!==this.props.dataLayer&&this.updateDataFromDataLayer()}},{key:"getStoryData",value:function(){var e=Object(D.a)(S.a.mark(function e(t){return S.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==this.props.dataLayer){e.next=4;break}e.t0=void 0,e.next=7;break;case 4:return e.next=6,this.props.dataLayer.getStoryData(t);case 6:e.t0=e.sent;case 7:return e.abrupt("return",e.t0);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),t}(i.a.Component),Z=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(m.a)(this,Object(v.a)(t).call(this,e))).state={items:[],allItems:[],activeList:V.Front,error:void 0,isLoading:!1},a.dataLayer=i.a.createRef(),a.updateActiveDataStore=a.updateActiveDataStore.bind(Object(y.a)(Object(y.a)(a))),a.newItemsProvided=a.newItemsProvided.bind(Object(y.a)(Object(y.a)(a))),a}return Object(g.a)(t,e),Object(b.a)(t,null,[{key:"getDerivedStateFromProps",value:function(e,t){var a;switch(e.match.params.page){case"day":a=V.Day;break;case"week":a=V.Week;break;case"month":a=V.Month;break;default:a=V.Front}return console.log("derived state",e.match.params.page,a),Object(h.a)({},t,{activeList:a})}}]),Object(b.a)(t,[{key:"updateActiveDataStore",value:function(e,t){t&&this.setState({items:e}),this.setState(function(t){var a=E.a.cloneDeep(t.allItems).concat(e);return a=E.a.uniqBy(a,function(e){return e.id}),console.log("new all itemS",a),{allItems:a}})}},{key:"render",value:function(){var e=this;return console.log("render state",this.state,this.dataLayer),void 0!==this.state.error?i.a.createElement("div",null,i.a.createElement("p",null,"an error occurred, refresh the page"),i.a.createElement("p",null,"unfortunately, your local data was cleared to prevent corruption")):i.a.createElement("div",null,i.a.createElement(I,{ref:this.dataLayer,provideNewItems:this.newItemsProvided,updateIsLoadingStatus:function(t){return e.setState({isLoading:t})},loadFreshSource:this.state.activeList}),i.a.createElement(A,{requestNewData:function(){e.state.isLoading||e.dataLayer.current.loadData(e.state.activeList)},isLoading:this.state.isLoading}),i.a.createElement(O.a,null,i.a.createElement(w.a,{path:"/story/:id",exact:!0,render:function(t){return i.a.createElement(Y,{id:+t.match.params.id,dataLayer:e.dataLayer.current,history:t.history,key:+t.match.params.id})}}),i.a.createElement(w.a,{path:"/:page?",render:function(t){return i.a.createElement(B,{items:null===e.dataLayer.current?[]:e.dataLayer.current.getPageData(t.match.params.page)})}})))}},{key:"newItemsProvided",value:function(e,t){t===this.state.activeList&&this.setState({items:e})}}]),t}(i.a.Component),ee=Object(j.a)(Z);!function(e){e[e.Front=0]="Front",e[e.Day=1]="Day",e[e.Week=2]="Week",e[e.Month=3]="Month"}(V||(V={}));var te=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function ae(e,t){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var a=e.installing;null!=a&&(a.onstatechange=function(){"installed"===a.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See http://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}}).catch(function(e){console.error("Error during service worker registration:",e)})}p.a.polyfill(),window.onerror=function(e,t,a,n,o){console.error("major error",e),r.a.clear(),document.body.innerHTML="<h1>major error occurred.  local storage cleared to avoid corruption. please refresh</h1>"},c.a.render(i.a.createElement(l.a,null,i.a.createElement(u.a,{path:"/:page?"},i.a.createElement(ee,null))),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",function(){var t="".concat("","/service-worker.js");te?(function(e,t){fetch(e).then(function(a){var n=a.headers.get("content-type");404===a.status||null!=n&&-1===n.indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):ae(e,t)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(t,e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit http://bit.ly/CRA-PWA")})):ae(t,e)})}}()},86:function(e,t,a){e.exports=a(156)},97:function(e,t,a){}},[[86,2,1]]]);
//# sourceMappingURL=main.c3c8714a.chunk.js.map